<!DOCTYPE html>
<!-- saved from url=(0042)http://master.tech-camp.in/curriculums/851 -->
<html lang="ja"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><style type="text/css">@charset "UTF-8";[ng\:cloak],[ng-cloak],[data-ng-cloak],[x-ng-cloak],.ng-cloak,.x-ng-cloak,.ng-hide:not(.ng-hide-animate){display:none !important;}ng\:form{display:block;}</style>
<script type="text/javascript" src="./スクレイピングで映画情報を取得しよう_files/d896f56e42"></script><script src="./スクレイピングで映画情報を取得しよう_files/nr-1026.min.js"></script><script async="" src="./スクレイピングで映画情報を取得しよう_files/analytics.js"></script><script type="text/javascript">window.NREUM||(NREUM={});NREUM.info={"beacon":"bam.nr-data.net","errorBeacon":"bam.nr-data.net","licenseKey":"d896f56e42","applicationID":"38109881","transactionName":"Jg5cQxBdCgkAQhYOXAgEHV4MVgMd","queueTime":0,"applicationTime":83,"agent":""}</script>
<script type="text/javascript">window.NREUM||(NREUM={}),__nr_require=function(e,n,t){function r(t){if(!n[t]){var o=n[t]={exports:{}};e[t][0].call(o.exports,function(n){var o=e[t][1][n];return r(o||n)},o,o.exports)}return n[t].exports}if("function"==typeof __nr_require)return __nr_require;for(var o=0;o<t.length;o++)r(t[o]);return r}({1:[function(e,n,t){function r(){}function o(e,n,t){return function(){return i(e,[c.now()].concat(u(arguments)),n?null:this,t),n?void 0:this}}var i=e("handle"),a=e(2),u=e(3),f=e("ee").get("tracer"),c=e("loader"),s=NREUM;"undefined"==typeof window.newrelic&&(newrelic=s);var p=["setPageViewName","setCustomAttribute","setErrorHandler","finished","addToTrace","inlineHit","addRelease"],d="api-",l=d+"ixn-";a(p,function(e,n){s[n]=o(d+n,!0,"api")}),s.addPageAction=o(d+"addPageAction",!0),s.setCurrentRouteName=o(d+"routeName",!0),n.exports=newrelic,s.interaction=function(){return(new r).get()};var m=r.prototype={createTracer:function(e,n){var t={},r=this,o="function"==typeof n;return i(l+"tracer",[c.now(),e,t],r),function(){if(f.emit((o?"":"no-")+"fn-start",[c.now(),r,o],t),o)try{return n.apply(this,arguments)}finally{f.emit("fn-end",[c.now()],t)}}}};a("setName,setAttribute,save,ignore,onEnd,getContext,end,get".split(","),function(e,n){m[n]=o(l+n)}),newrelic.noticeError=function(e){"string"==typeof e&&(e=new Error(e)),i("err",[e,c.now()])}},{}],2:[function(e,n,t){function r(e,n){var t=[],r="",i=0;for(r in e)o.call(e,r)&&(t[i]=n(r,e[r]),i+=1);return t}var o=Object.prototype.hasOwnProperty;n.exports=r},{}],3:[function(e,n,t){function r(e,n,t){n||(n=0),"undefined"==typeof t&&(t=e?e.length:0);for(var r=-1,o=t-n||0,i=Array(o<0?0:o);++r<o;)i[r]=e[n+r];return i}n.exports=r},{}],4:[function(e,n,t){n.exports={exists:"undefined"!=typeof window.performance&&window.performance.timing&&"undefined"!=typeof window.performance.timing.navigationStart}},{}],ee:[function(e,n,t){function r(){}function o(e){function n(e){return e&&e instanceof r?e:e?f(e,u,i):i()}function t(t,r,o,i){if(!d.aborted||i){e&&e(t,r,o);for(var a=n(o),u=m(t),f=u.length,c=0;c<f;c++)u[c].apply(a,r);var p=s[y[t]];return p&&p.push([b,t,r,a]),a}}function l(e,n){v[e]=m(e).concat(n)}function m(e){return v[e]||[]}function w(e){return p[e]=p[e]||o(t)}function g(e,n){c(e,function(e,t){n=n||"feature",y[t]=n,n in s||(s[n]=[])})}var v={},y={},b={on:l,emit:t,get:w,listeners:m,context:n,buffer:g,abort:a,aborted:!1};return b}function i(){return new r}function a(){(s.api||s.feature)&&(d.aborted=!0,s=d.backlog={})}var u="nr@context",f=e("gos"),c=e(2),s={},p={},d=n.exports=o();d.backlog=s},{}],gos:[function(e,n,t){function r(e,n,t){if(o.call(e,n))return e[n];var r=t();if(Object.defineProperty&&Object.keys)try{return Object.defineProperty(e,n,{value:r,writable:!0,enumerable:!1}),r}catch(i){}return e[n]=r,r}var o=Object.prototype.hasOwnProperty;n.exports=r},{}],handle:[function(e,n,t){function r(e,n,t,r){o.buffer([e],r),o.emit(e,n,t)}var o=e("ee").get("handle");n.exports=r,r.ee=o},{}],id:[function(e,n,t){function r(e){var n=typeof e;return!e||"object"!==n&&"function"!==n?-1:e===window?0:a(e,i,function(){return o++})}var o=1,i="nr@id",a=e("gos");n.exports=r},{}],loader:[function(e,n,t){function r(){if(!x++){var e=h.info=NREUM.info,n=d.getElementsByTagName("script")[0];if(setTimeout(s.abort,3e4),!(e&&e.licenseKey&&e.applicationID&&n))return s.abort();c(y,function(n,t){e[n]||(e[n]=t)}),f("mark",["onload",a()+h.offset],null,"api");var t=d.createElement("script");t.src="https://"+e.agent,n.parentNode.insertBefore(t,n)}}function o(){"complete"===d.readyState&&i()}function i(){f("mark",["domContent",a()+h.offset],null,"api")}function a(){return E.exists&&performance.now?Math.round(performance.now()):(u=Math.max((new Date).getTime(),u))-h.offset}var u=(new Date).getTime(),f=e("handle"),c=e(2),s=e("ee"),p=window,d=p.document,l="addEventListener",m="attachEvent",w=p.XMLHttpRequest,g=w&&w.prototype;NREUM.o={ST:setTimeout,CT:clearTimeout,XHR:w,REQ:p.Request,EV:p.Event,PR:p.Promise,MO:p.MutationObserver};var v=""+location,y={beacon:"bam.nr-data.net",errorBeacon:"bam.nr-data.net",agent:"js-agent.newrelic.com/nr-1026.min.js"},b=w&&g&&g[l]&&!/CriOS/.test(navigator.userAgent),h=n.exports={offset:u,now:a,origin:v,features:{},xhrWrappable:b};e(1),d[l]?(d[l]("DOMContentLoaded",i,!1),p[l]("load",r,!1)):(d[m]("onreadystatechange",o),p[m]("onload",r)),f("mark",["firstbyte",u],null,"api");var x=0,E=e(4)},{}]},{},["loader"]);</script><title>スクレイピングで映画情報を取得しよう</title><link href="./スクレイピングで映画情報を取得しよう_files/application-ee235c2c69f0123100ca0233ac9bf6ea4eefd02b15a188f1f5e7c9fa904bfdfb.css" media="all" rel="stylesheet"><script src="./スクレイピングで映画情報を取得しよう_files/bundle.app-fbb361722a822ae8266ace1de986c9e7bc61c1f64d90d9bc8a7d7012db97eb6a.js"></script><link href="./スクレイピングで映画情報を取得しよう_files/icon.css" rel="stylesheet"><meta content="authenticity_token" name="csrf-param">
<meta content="/YXEtD3/fMVvrmsOgBbG6GHk/PaourjJe0/GAWZLB+M=" name="csrf-token"><link href="http://master.tech-camp.in/favicon.ico" rel="icon" sizes="16x16 32x32 48x48 128x128 256x256"><link href="./スクレイピングで映画情報を取得しよう_files/font-awesome.min.css" rel="stylesheet"><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-33391559-9', 'auto');
ga('send', 'pageview');</script></head><body ng-app="techMaster" class="ng-scope"><div class="header navbar main_header navbar-fixed-top" id="header" role="navigation"><div class="container"><div class="navbar-header"><button aria-controls="navbar" aria-expanded="false" class="navbar-toggle collapsed" data-target="#navbar" data-toggle="collapse" type="button"><span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button><a class="navbar-brand" href="http://master.tech-camp.in/" target="_self"><img alt="TECH::MASTER" src="./スクレイピングで映画情報を取得しよう_files/logo-a092b24686f2404f48e1ef25bd8bfe7445b458e4587da135059132b867b10cbd.svg"></a></div><div class="navbar-collapse collapse" id="navbar"><ul class="nav navbar-nav navbar-right"><li id="after_graduate"><p>卒業後の目標:研修内容で習った事関して...</p></li><li><p>終了まで<strong>10</strong>日</p></li><script>$(function() {
  var menuHeight = $(window).height() - 80;
  $('#js-menuheight').css('max-height', menuHeight + 'px');

  $('.js-switch-list').on('click', function(e) {
    e.stopPropagation();
    $('.js-list-group').toggle();
  });

  $('.js-course-select').on('click', function(e) {
    e.stopPropagation();
    var checkBox = $(this).find('input[type=checkbox]');
    checkBox.prop('checked', !checkBox.prop('checked'));
    $(this).hasClass('bg-info') ? $(this).removeClass('bg-info') : $(this).addClass('bg-info');
  });
});</script><li><p>平野 水稀</p></li><li class="profileDropdown" data-target="#user-list"><a class="js-dropdown" id="profileDropdown"><img alt="平野 水稀" class="avatar" src="./スクレイピングで映画情報を取得しよう_files/noimage.png"><i aria-hidden="true" class="fa fa-caret-down"></i></a><ul class="inner-list" id="user-list" style="display: none;"><li><a href="http://master.tech-camp.in/me" target="_self">アカウント</a></li><li><a href="http://master.tech-camp.in/users" target="_self">一期生一覧</a></li><li><a href="https://tech-camp.in/#faq" target="_blank">FAQ</a></li></ul></li><script>$(function() {
  $('#profileDropdown').on('click', function() {
    $('.popover').toggle();
  });
});</script></ul></div></div></div><p class="alert alert-danger">既にログイン済みです。</p><div class="navigation_banners"><div class="navigation-banner"><div class="container"><div class="navbar-header"><span class="banner-icon banner-icon-notice">お知らせ</span>5/27(土)18時~23時は渋谷校でイベント開催のためA教室を閉館とさせていただきます。当日はB教室・9Fにて学習可能です。ご不便をおかけいたしますがどうぞよろしくお願い致します。</div></div></div><div class="navigation-banner"><div class="container"><div class="navbar-header"><span class="banner-icon banner-icon-notice">お知らせ</span>TECH::CAMPでの学習は完了しましたか？期間終了後もそのままカリキュラムの閲覧のみ継続できます。学習を延長するなら<a class="banner-link" href="https://tech-camp.in/extensions/new" target="_blank">こちら</a></div></div></div><div class="navigation-banner"><div class="container"><div class="navbar-header"><span class="banner-icon banner-icon-notice">募集</span>TECH::CAMPを支えるメンターになりませんか？ハイレベルな仲間と共に、技術をさらに向上させたい方は必見です！詳しくは<a class="banner-link" href="https://tech-camp.in/intern/index.html" target="_blank">こちら</a></div></div></div></div><!-- ngView:  --><div autoscroll="" ng-view="" class="ng-scope"><curriculum class="ng-scope" style="display: inline;">
  <div class="container" id="curriculum">
    <div class="row curriculum-inner">
      <div class="col-lg-12 main" ng-init="init()">
        <div class="page-header page" style="background-image: url(&quot;https://tech-master.s3-ap-northeast-1.amazonaws.com/uploads/c_title_image/content/269/2619781448_190e9d4f26_b.jpg?X-Amz-Expires=600&amp;X-Amz-Date=20170518T060219Z&amp;X-Amz-Algorithm=AWS4-HMAC-SHA256&amp;X-Amz-Credential=AKIAINAMMGOFK72FFELA/20170518/ap-northeast-1/s3/aws4_request&amp;X-Amz-SignedHeaders=host&amp;X-Amz-Signature=063ed55b7573d91b82cbc42abfcf89a8757168764470db55ecf9575b8e9fb306&quot;);" ng-show="curriculum.image">
  <h1 class="ng-binding">
    Laravelアプリケーション開発2 第2章<small class="ng-binding">〜スクレイピングで映画情報を取得しよう〜</small>
  </h1>
  <!-- ngIf: curriculum.image.description.length --><div class="flickr_attr ng-binding ng-scope" ng-if="curriculum.image.description.length">
    エトワール凱旋門。1806年、フランスの英雄として知られるナポレオンの命により建設が開始されました。30年後の1836年に完成しましたがこの時ナポレオンは既に死去しており、彼がこの門をくぐったのはパリに改葬された時でした。この凱旋門を中心に12本の通りが放射線状に伸びており、その形が地図上で光り輝く星のように見えるのでこの広場は「星の広場」と呼ばれていたそうです。<a href="https://www.flickr.com/photos/kieranlynam/2619781448/" target="_blank" class="ng-binding">Kieran Lynam - Arc de triomphe de l'Étoile</a>
  </div><!-- end ngIf: curriculum.image.description.length -->
</div>
      </div>
      <div class="col-md-9 col-sm-12" id="curriculumMainContainer">
        <div class="curriculum_content">
          <div class="curriculum_text ng-scope" compile-progress-notifier="willCompiledCurriculumText" ng-controller="CurriculumHintController"><h1 class="ng-scope" id="1">学習目標</h1>

<p class="ng-scope">実際の練習問題を通して、スクレイピングの仕方を理解しよう</p>

<h1 class="ng-scope" id="2">学習キーワード</h1>

<ul class="ng-scope">
<li>スクレイピング</li>
</ul>

<h1 class="ng-scope" id="3">映画のデータを用意しよう</h1>

<h2 class="ng-scope" id="4">映画のデータ</h2>

<p class="ng-scope">映画レビューサイトの実装をする前にまずは映画レビューサイトに必要な<strong>映画のデータ</strong>を用意しましょう。映画レビューサイトではヘッダー部分からレビューを投稿することができます。</p>

<p class="ng-scope"><img src="./スクレイピングで映画情報を取得しよう_files/04.png" alt="投稿する" title="投稿する"></p>

<p class="ng-scope">レビューを投稿するときにレビューをつける映画を選択します。</p>

<p class="ng-scope"><img src="./スクレイピングで映画情報を取得しよう_files/05.png" alt="映画選択" title="映画選択"></p>

<p class="ng-scope">レビューはユーザーが生成する情報です。では、この映画の情報はどこにあるのでしょうか？これはあらかじめ、アプリケーションのデータベースに映画の情報を入れておくのです。</p>

<h2 class="ng-scope" id="5">プログラムで映画の情報を取得しよう</h2>

<p class="ng-scope">どうやってデータベースに映画の情報を用意するのでしょうか。１つ１つ自力でデータベースに映画のタイトルや画像の情報を入れるのは大変すぎますね。そこでプログラムを使って映画の情報を自動で取得してきましょう。</p>

<p class="ng-scope">そこで使うのが<strong>スクレイピング</strong>と呼ばれる技術です。</p>

<h1 class="ng-scope" id="6">スクレイピング</h1>

<p class="ng-scope">スクレイピングを使って映画の情報を取得しましょう。</p>

<h2 class="ng-scope" id="7">スクレイピングとは</h2>

<p class="ng-scope">スクレイピングとは、ウェブサイト上のHTMLからある特定のデータを抜き出す処理のことを言います。<br>
外部のサーバーからデータを抽出し、集計をしたりするときに役立ちます。</p>

<h3 class="ng-scope">
<i class="icon information" id="term_379"></i> スクレイピング</h3>

<p class="ng-scope">例えば、以下のようなHTMLのサイトがあった場合</p>

<div class="code-frame ng-scope" data-lang="html"><table class="highlighttable"><tbody><tr>
<td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td>
<td class="code">
<div class="highlight"><pre>  <span class="nt">&lt;ul&gt;</span>
    <span class="nt">&lt;li&gt;</span>TEST1<span class="nt">&lt;/li&gt;</span>
    <span class="nt">&lt;li&gt;</span>TEST2<span class="nt">&lt;/li&gt;</span>
    <span class="nt">&lt;li&gt;</span>TEST3<span class="nt">&lt;/li&gt;</span>
  <span class="nt">&lt;/ul&gt;</span>
</pre></div>
</td>
</tr></tbody></table></div>

<p class="ng-scope">&lt;ul&gt;&lt;li&gt;の中にある「TEST1、TEST2、TEST3」等の値を取り出すことを言います。</p>

<p class="ng-scope"><form action="http://master.tech-camp.in/curriculums/851#" data-id="3919" class="ng-pristine ng-valid ng-scope">
  <h4 class="ng-binding">
    <i class="icon check_icon_00"></i>要点チェック
  </h4>
  <!-- ngRepeat: check in checkbox.checks --><label for="check-5484" ng-repeat="check in checkbox.checks" class="ng-scope"><input id="check-5484" name="check-5484" ng-change="change_checkbox_value(check)" ng-model="check.checked" type="checkbox" class="ng-pristine ng-untouched ng-valid"><span ng-bind-html="check.text" class="ng-binding">スクレイピングとはウェブサイト上のHTMLからある特定のデータを抜き出す処理のこと</span></label><!-- end ngRepeat: check in checkbox.checks -->
</form></p>

<h2 class="ng-scope" id="8">スクレイピングで映画情報を取得しよう</h2>

<p class="ng-scope">映画レビューサイトで使用するための映画情報をスクレイピングで取得しましょう。</p>

<p class="ng-scope">今回は映画の情報が欲しいので、<strong>movie-review</strong>という映画情報サイトから、スクレイピングで映画作品データを取得して「非公開」で利用します。</p>

<p class="ng-scope"><i class="icon attention"></i>**データの著作権があるため、外部公開はできません。</p>

<p class="ng-scope">movie-reviewのサイトはこちら → <a href="http://review-movie.herokuapp.com/" target="_blank">movie-review</a></p>

<p class="ng-scope"><img src="./スクレイピングで映画情報を取得しよう_files/cec86f89a4f337340be5998a900fa243.png" alt="https://tech-master.s3.amazonaws.com/uploads/curriculums//cec86f89a4f337340be5998a900fa243.png"></p>

<h2 class="ng-scope" id="9">スクレイピングしてみよう</h2>

<p class="ng-scope">では実際にスクレイピングでHTML内のデータを取得してみましょう。PHPでのスクレイピングには<strong>PHP Simple HTML DOM Parser</strong>を使います。</p>

<h3 class="ng-scope">
<i class="icon information" id="term_380"></i> PHP Simple HTML DOM Parser</h3>

<p class="ng-scope">PHP Simple HTML DOM ParserはPHPでスクレイピングを行う際に使うライブラリです。PHP Simple HTML DOM Parserは<code>simple_html_dom.php</code>ファイルをダウンロードして読み込むだけで使うことができます。この<code>simple_html_dom.php</code>ファイルにはスクレイピングをするための様々なメソッドが用意されています。</p>

<p class="ng-scope">では、simple_html_dom.phpを入れてみましょう。 <a href="https://sourceforge.net/projects/simplehtmldom/files/" target="_blank">こちらのサイト</a>にアクセスをしてsimple_html_dom.phpファイルをダウンロードしましょう。</p>

<p class="ng-scope"><img src="./スクレイピングで映画情報を取得しよう_files/6d3caeba267d720b982554e9431b1c8a.png" alt="simpleHTMLDom.php"></p>

<p class="ng-scope">ダウンロードしたファイルはDesktop上に配置してください。</p>

<p class="ng-scope"><form action="http://master.tech-camp.in/curriculums/851#" data-id="3920" class="ng-pristine ng-valid ng-scope">
  <h4 class="ng-binding">
    <i class="icon check_icon_01"></i>作業チェック
  </h4>
  <!-- ngRepeat: check in checkbox.checks --><label for="check-5485" ng-repeat="check in checkbox.checks" class="ng-scope"><input id="check-5485" name="check-5485" ng-change="change_checkbox_value(check)" ng-model="check.checked" type="checkbox" class="ng-pristine ng-untouched ng-valid"><span ng-bind-html="check.text" class="ng-binding">simple_html_dom.phpファイルをダウンロードすることが出来た</span></label><!-- end ngRepeat: check in checkbox.checks --><label for="check-6667" ng-repeat="check in checkbox.checks" class="ng-scope"><input id="check-6667" name="check-6667" ng-change="change_checkbox_value(check)" ng-model="check.checked" type="checkbox" class="ng-pristine ng-untouched ng-valid"><span ng-bind-html="check.text" class="ng-binding">ダウンロードしたファイルをDesktop上に配置することが出来た</span></label><!-- end ngRepeat: check in checkbox.checks -->
</form></p>

<p class="ng-scope"><form action="http://master.tech-camp.in/curriculums/851#" data-id="3921" class="ng-pristine ng-valid ng-scope">
  <h4 class="ng-binding">
    <i class="icon check_icon_00"></i>要点チェック
  </h4>
  <!-- ngRepeat: check in checkbox.checks --><label for="check-5487" ng-repeat="check in checkbox.checks" class="ng-scope"><input id="check-5487" name="check-5487" ng-change="change_checkbox_value(check)" ng-model="check.checked" type="checkbox" class="ng-pristine ng-untouched ng-valid"><span ng-bind-html="check.text" class="ng-binding">PHP Simple HTML DOM ParserはPHPでスクレイピングをするためのライブラリ</span></label><!-- end ngRepeat: check in checkbox.checks -->
</form></p>

<h2 class="ng-scope" id="10">ウェブサイトのHTML情報を取得する</h2>

<h3 class="ng-scope">
<i class="icon information" id="term_381"></i> require_once構文</h3>

<p class="ng-scope">require_once構文はファイルを指定し、そのファイルを一度だけ読み込むことができます。先ほどsimple_html_dom.phpファイルを配置しましたが、このファイルを反映させるためにはrequire_onceを使って読み込む必要があります。読み込みは <code>require_once('simple_html_dom.php')</code>とファイル名を指定します。</p>

<h3 class="ng-scope">[例]</h3>

<div class="code-frame ng-scope" data-lang="php"><table class="highlighttable"><tbody><tr>
<td class="linenos"><div class="linenodiv"><pre>1</pre></div></td>
<td class="code">
<div class="highlight"><pre>  <span class="k">require_once</span> <span class="s1">'simple_html_dom.php'</span><span class="p">;</span>
</pre></div>
</td>
</tr></tbody></table></div>

<p class="ng-scope">またrequire_onceと似た構文でrequire構文が存在します。</p>

<h3 class="ng-scope">
<i class="icon information" id="term_381"></i> requireとrequire_onceの違い</h3>

<p class="ng-scope">require構文は指定した回数だけファイルを読み込みます。例えば、require('simple_html_dom.php')と3回記述すると3回simple_html_dom.phpファイルが読み込まれます。一方で、require_onceは再読み込みをしません。require_onceを使うと一度読み込んだファイルがあれば同じ名前のファイルは2回目以降読み込まれなくなります。そうすることで、関数の再定義や変数に再代入によるエラーを未然に防ぐことができます。</p>

<p class="ng-scope">よって、本カリキュラムではrequire_onceを使って実装していきます。</p>

<h2 class="ng-scope" id="11">ウェブサイトのHTML情報を取得する</h2>

<h3 class="ng-scope">
<i class="icon information" id="term_381"></i> file_get_htmlメソッド</h3>

<p class="ng-scope">file_get_htmlメソッドはsimple_html_dom.phpファイルに定義されているメソッドです。file_get_html("スクレイピングしたいウェブサイトのURL")と引数にURLの文字列を指定することで、そのURLのウェブサイトのHTMLを取得します。</p>

<h3 class="ng-scope">[例]</h3>

<div class="code-frame ng-scope" data-lang="php"><table class="highlighttable"><tbody><tr>
<td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td>
<td class="code">
<div class="highlight"><pre>  <span class="k">require_once</span> <span class="s1">'simple_html_dom.php'</span><span class="p">;</span>
<span class="hll">  <span class="nv">$page</span> <span class="o">=</span> <span class="nx">file_get_html</span><span class="p">(</span><span class="s1">'http://review-movie.herokuapp.com/'</span><span class="p">);</span> <span class="c1">// movie-reviewのHTMLを取得</span>
</span></pre></div>
</td>
</tr></tbody></table></div>

<p class="ng-scope">ここで取得できた<code>$page</code>は単なるHTMLの文字列ではなくその<strong>ウェブサイトのHTMLの情報を持ったsimple_html_dom_nodeインスタンスです。</strong></p>

<h3 class="ng-scope">[例]</h3>

<div class="code-frame ng-scope" data-lang="php"><table class="highlighttable"><tbody><tr>
<td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29</pre></div></td>
<td class="code">
<div class="highlight"><pre>  <span class="k">require_once</span> <span class="s1">'simple_html_dom.php'</span><span class="p">;</span>
  <span class="nv">$page</span> <span class="o">=</span> <span class="nx">file_get_html</span><span class="p">(</span><span class="s1">'http://review-movie.herokuapp.com/'</span><span class="p">);</span> <span class="c1">// movie-reviewのHTMLを取得</span>
<span class="hll">  <span class="nb">var_dump</span><span class="p">(</span><span class="nv">$page</span><span class="p">);</span>
</span>  <span class="nx">object</span><span class="p">(</span><span class="nx">simple_html_dom_node</span><span class="p">)</span><span class="c1">#90 (9) {</span>
                                                                <span class="p">[</span><span class="s2">"nodetype"</span><span class="p">]</span><span class="o">=&gt;</span>
                                                                <span class="nx">int</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
                                                                <span class="p">[</span><span class="s2">"tag"</span><span class="p">]</span><span class="o">=&gt;</span>
                                                                <span class="nx">string</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="s2">"text"</span>
                                                                <span class="p">[</span><span class="s2">"attr"</span><span class="p">]</span><span class="o">=&gt;</span>
                                                                <span class="k">array</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                                                                <span class="p">}</span>
                                                                <span class="p">[</span><span class="s2">"children"</span><span class="p">]</span><span class="o">=&gt;</span>
                                                                <span class="k">array</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                                                                <span class="p">}</span>
                                                                <span class="p">[</span><span class="s2">"nodes"</span><span class="p">]</span><span class="o">=&gt;</span>
                                                                <span class="k">array</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                                                                <span class="p">}</span>
                                                                <span class="p">[</span><span class="s2">"parent"</span><span class="p">]</span><span class="o">=&gt;</span>
                                                                <span class="o">*</span><span class="nx">RECURSION</span><span class="o">*</span>
                                                                <span class="p">[</span><span class="s2">"_"</span><span class="p">]</span><span class="o">=&gt;</span>
                                                                <span class="k">array</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
                                                                  <span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">=&gt;</span>
                                                                  <span class="nx">string</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span> <span class="s2">"Comic Books"</span>
                                                                <span class="p">}</span>
                                                                <span class="p">[</span><span class="s2">"tag_start"</span><span class="p">]</span><span class="o">=&gt;</span>
                                                                <span class="nx">int</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                                                                <span class="p">[</span><span class="s2">"dom"</span><span class="o">:</span><span class="s2">"simple_html_dom_node"</span><span class="o">:</span><span class="k">private</span><span class="p">]</span><span class="o">=&gt;</span>
                                                                <span class="o">*</span><span class="nx">RECURSION</span><span class="o">*</span>
                                                              <span class="p">}</span>
</pre></div>
</td>
</tr></tbody></table></div>

<p class="ng-scope">このような<code>simple_html_dom_nodeインスタンス</code>の複雑な入れ子構造になっています。このインスタンスの詳細については理解する必要はありません。</p>

<p class="ng-scope"><form action="http://master.tech-camp.in/curriculums/851#" data-id="3922" class="ng-pristine ng-valid ng-scope">
  <h4 class="ng-binding">
    <i class="icon check_icon_00"></i>要点チェック
  </h4>
  <!-- ngRepeat: check in checkbox.checks --><label for="check-5488" ng-repeat="check in checkbox.checks" class="ng-scope"><input id="check-5488" name="check-5488" ng-change="change_checkbox_value(check)" ng-model="check.checked" type="checkbox" class="ng-pristine ng-untouched ng-valid"><span ng-bind-html="check.text" class="ng-binding">require_once構文は同一名のファイルを一度だけ読み込む</span></label><!-- end ngRepeat: check in checkbox.checks --><label for="check-5489" ng-repeat="check in checkbox.checks" class="ng-scope"><input id="check-5489" name="check-5489" ng-change="change_checkbox_value(check)" ng-model="check.checked" type="checkbox" class="ng-pristine ng-untouched ng-valid"><span ng-bind-html="check.text" class="ng-binding">file_get_html()メソッドはウェブサイトのHTML情報を取得する</span></label><!-- end ngRepeat: check in checkbox.checks -->
</form></p>

<h2 class="ng-scope" id="12">HTML情報から指定のタグ要素の情報を検索する</h2>

<p class="ng-scope">特定のhtmlタグ情報を取得するには <strong>findメソッド</strong> を使います。</p>

<h3 class="ng-scope">
<i class="icon information" id="term_382"></i> findメソッド</h3>

<p class="ng-scope">findメソッドはfile_get_htmlメソッドで取得したページの情報が入ったインスタンスに対して使用します。これを使うと取得したウェブサイトのHTML情報の中から指定したHTML要素の内容を検索できます。<br>
<strong>該当するHTMLのタグ要素が1つでも、返り値は配列の形式で返ってきます。</strong></p>

<p class="ng-scope">findメソッドは以下のような使い方をします。</p>

<h3 class="ng-scope">[例]</h3>

<div class="code-frame ng-scope" data-lang="php"><table class="highlighttable"><tbody><tr>
<td class="linenos"><div class="linenodiv"><pre>1</pre></div></td>
<td class="code">
<div class="highlight"><pre>  <span class="nv">$elements</span> <span class="o">=</span> <span class="nx">simple_html_domインスタンス</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">(</span><span class="s1">'セレクタ'</span><span class="p">);</span>
</pre></div>
</td>
</tr></tbody></table></div>

<p class="ng-scope">引数の<strong>セレクタ</strong>とはCSSのようにHTMLのタグの要素名を指定します。<code>'h1'</code>や<code>'li a'</code>のような指定です。また、クラス名でも<code>.hoge</code>のように指定することが出来ます。</p>

<p class="ng-scope">では、例として<a>movieのページ</a>から<strong>h2要素のHTMLの情報</strong>を取得してみます。また、取得した値をechoで表示します。ところが、findメソッドで取得した値は配列になっています。echoを使って値を確認したい場合、配列に対してはechoは使えないため、配列の最初の要素を[0]で指定し、出力します。</p>

<div class="code-frame ng-scope" data-lang="php"><table class="highlighttable"><tbody><tr>
<td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td>
<td class="code">
<div class="highlight"><pre>  <span class="k">require_once</span> <span class="s1">'simple_html_dom.php'</span><span class="p">;</span>
  <span class="nv">$page</span> <span class="o">=</span> <span class="nx">file_get_html</span><span class="p">(</span><span class="s1">'http://review-movie.herokuapp.com/'</span><span class="p">);</span> <span class="c1"># movie-reviewのHTMLを取得</span>
<span class="hll">  <span class="nv">$elements</span> <span class="o">=</span> <span class="nv">$page</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">(</span><span class="s1">'h2'</span><span class="p">);</span> <span class="c1">// h2要素を検索</span>
</span>  <span class="k">echo</span> <span class="nv">$elements</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span> <span class="c1">// 配列に対してechoは使えないので、要素を1つだけ取得します</span>
</pre></div>
</td>
</tr></tbody></table></div>

<p class="ng-scope">これを実行すると以下のような出力を得られます。</p>

<div class="code-frame ng-scope" data-lang="bash"><table class="highlighttable"><tbody><tr>
<td class="linenos"><div class="linenodiv"><pre>1</pre></div></td>
<td class="code">
<div class="highlight"><pre>&lt;h2 <span class="nv">class</span><span class="o">=</span><span class="s2">"entry-title index-entry-title"</span>&gt;&lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">"/products/291"</span> <span class="nv">title</span><span class="o">=</span><span class="s2">"Single Post"</span>&gt;ゴジラ・ミニラ・ガバラ オール怪獣大進撃&lt;/a&gt;             &lt;/h2&gt;
</pre></div>
</td>
</tr></tbody></table></div>

<p class="ng-scope">ちゃんと、movie-reveiwのh2要素のHTMLの情報が取得できました。<br>
次は<strong>li要素の下のa要素</strong>のHTML情報を取得してみます。</p>

<h3 class="ng-scope">[例]</h3>

<div class="code-frame ng-scope" data-lang="php"><table class="highlighttable"><tbody><tr>
<td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td>
<td class="code">
<div class="highlight"><pre>  <span class="k">require_once</span> <span class="s1">'simple_html_dom.php'</span><span class="p">;</span>
  <span class="nv">$page</span> <span class="o">=</span> <span class="nx">file_get_html</span><span class="p">(</span><span class="s1">'http://review-movie.herokuapp.com/'</span><span class="p">);</span> <span class="c1"># movie-reviewのHTMLを取得</span>
<span class="hll">  <span class="nv">$elements</span> <span class="o">=</span> <span class="nv">$page</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">(</span><span class="s1">'h2 a'</span><span class="p">);</span> <span class="c1">// h2要素の下のa要素を検索</span>
</span>  <span class="k">echo</span> <span class="nx">elements</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
</pre></div>
</td>
</tr></tbody></table></div>

<p class="ng-scope">これを実行すると以下のような出力を得られます。</p>

<div class="code-frame ng-scope" data-lang="bash">
<div class="code-lang"><span class="bold">ターミナル</span></div>
<table class="highlighttable"><tbody><tr>
<td class="linenos"><div class="linenodiv"><pre>1</pre></div></td>
<td class="code">
<div class="highlight"><pre>&lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">"/products/291"</span> <span class="nv">title</span><span class="o">=</span><span class="s2">"Single Post"</span>&gt;ゴジラ・ミニラ・ガバラ オール怪獣大進撃&lt;/a&gt;
</pre></div>
</td>
</tr></tbody></table>
</div>

<p class="ng-scope">このように、返ってきた値の1番目の要素をとりだすことができるので<strong>配列の形式で返ってきている</strong>ことが分かります。</p>

<p class="ng-scope">では、findメソッドで指定した要素のHTMLからテキストやリンク先を取得しましょう。</p>

<p class="ng-scope"><form action="http://master.tech-camp.in/curriculums/851#" data-id="3923" class="ng-pristine ng-valid ng-scope">
  <h4 class="ng-binding">
    <i class="icon check_icon_00"></i>要点チェック
  </h4>
  <!-- ngRepeat: check in checkbox.checks --><label for="check-5490" ng-repeat="check in checkbox.checks" class="ng-scope"><input id="check-5490" name="check-5490" ng-change="change_checkbox_value(check)" ng-model="check.checked" type="checkbox" class="ng-pristine ng-untouched ng-valid"><span ng-bind-html="check.text" class="ng-binding">find()メソッドはHTML情報の中から指定したHTML要素を取得する</span></label><!-- end ngRepeat: check in checkbox.checks -->
</form></p>

<h2 class="ng-scope" id="13">HTML情報からテキストを抜き出そう</h2>

<h3 class="ng-scope">
<i class="icon information" id="term_383"></i> plaintextメソッド</h3>

<p class="ng-scope">findメソッドで得られたHTML情報のテキストを取得したい場合、plaintextメソッドを使います。</p>

<p class="ng-scope">例えば、先ほどのfindメソッドから取得した<code>'li a'</code>のい最初の要素を見てみましょう。</p>

<h3 class="ng-scope">[例]</h3>

<div class="code-frame ng-scope" data-lang="php"><table class="highlighttable"><tbody><tr>
<td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td>
<td class="code">
<div class="highlight"><pre>  <span class="k">require_once</span> <span class="s1">'simple_html_dom.php'</span><span class="p">;</span>
  <span class="nv">$page</span> <span class="o">=</span> <span class="nx">file_get_html</span><span class="p">(</span><span class="s1">'http://review-movie.herokuapp.com/'</span><span class="p">);</span> <span class="c1">// movie-reviewのHTMLを取得</span>
  <span class="nv">$elements</span> <span class="o">=</span> <span class="nv">$page</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">(</span><span class="s1">'h2 a'</span><span class="p">);</span> <span class="c1">// h2要素の下のa要素を検索</span>
  <span class="k">echo</span> <span class="nx">elements</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
</pre></div>
</td>
</tr></tbody></table></div>

<p class="ng-scope">ターミナルの出力</p>

<div class="code-frame ng-scope" data-lang="bash">
<div class="code-lang"><span class="bold">ターミナル</span></div>
<table class="highlighttable"><tbody><tr>
<td class="linenos"><div class="linenodiv"><pre>1</pre></div></td>
<td class="code">
<div class="highlight"><pre>&lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">"/products/291"</span> <span class="nv">title</span><span class="o">=</span><span class="s2">"Single Post"</span>&gt;ゴジラ・ミニラ・ガバラ オール怪獣大進撃&lt;/a&gt;
</pre></div>
</td>
</tr></tbody></table>
</div>

<p class="ng-scope">これらの要素のテキスト、すなわち「ゴジラ・ミニラ・ガバラ オール怪獣大進撃」が欲しい場合は以下のようにします。</p>

<h3 class="ng-scope">[例]</h3>

<div class="code-frame ng-scope" data-lang="php"><table class="highlighttable"><tbody><tr>
<td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td>
<td class="code">
<div class="highlight"><pre>  <span class="k">require_once</span> <span class="s1">'simple_html_dom.php'</span><span class="p">;</span>
  <span class="nv">$page</span> <span class="o">=</span> <span class="nx">file_get_html</span><span class="p">(</span><span class="s1">'http://review-movie.herokuapp.com/'</span><span class="p">);</span> <span class="c1">// movie-reviewのHTMLを取得</span>
  <span class="nv">$elements</span> <span class="o">=</span> <span class="nv">$page</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">(</span><span class="s1">'h2 a'</span><span class="p">);</span> <span class="c1">// h2要素の下のa要素を検索</span>
  <span class="k">foreach</span> <span class="p">(</span><span class="nv">$elements</span> <span class="k">as</span> <span class="nv">$ele</span><span class="p">)</span>
  <span class="p">{</span>
<span class="hll">      <span class="k">echo</span> <span class="nv">$ele</span><span class="o">-&gt;</span><span class="na">plaintext</span><span class="p">,</span> <span class="nx">PHP_EOL</span><span class="p">;</span>
</span>  <span class="p">}</span>
</pre></div>
</td>
</tr></tbody></table></div>

<p class="ng-scope">ターミナルの出力</p>

<div class="code-frame ng-scope" data-lang="bash">
<div class="code-lang"><span class="bold">ターミナル</span></div>
<table class="highlighttable"><tbody><tr>
<td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td>
<td class="code">
<div class="highlight"><pre>ゴジラ・ミニラ・ガバラ オール怪獣大進撃
千羽鶴（1969）
或る終焉
神様メール

<span class="c"># 多すぎるので以下略</span>
</pre></div>
</td>
</tr></tbody></table>
</div>

<p class="ng-scope">ちゃんとHTML情報のテキストだけが抜き出されました。findメソッドでは該当する要素のHTML情報がすべて取得できるので<strong>foreach関数を使って、１つ１つのインスタンスに対してplaintextメソッドを呼び出します。</strong></p>

<p class="ng-scope"><form action="http://master.tech-camp.in/curriculums/851#" data-id="3924" class="ng-pristine ng-valid ng-scope">
  <h4 class="ng-binding">
    <i class="icon check_icon_00"></i>要点チェック
  </h4>
  <!-- ngRepeat: check in checkbox.checks --><label for="check-5491" ng-repeat="check in checkbox.checks" class="ng-scope"><input id="check-5491" name="check-5491" ng-change="change_checkbox_value(check)" ng-model="check.checked" type="checkbox" class="ng-pristine ng-untouched ng-valid"><span ng-bind-html="check.text" class="ng-binding">plaintextメソッドは、HTML情報のテキストのみを取得する</span></label><!-- end ngRepeat: check in checkbox.checks -->
</form></p>

<h2 class="ng-scope" id="14">HTML情報から属性の値を抜き出そう</h2>

<p class="ng-scope">属性はHTML情報のインスタンスからアロー演算子を用いてアクセスすることができます。</p>

<div class="code-frame ng-scope" data-lang="bash">
<div class="code-lang"><span class="bold">ターミナル</span></div>
<table class="highlighttable"><tbody><tr>
<td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td>
<td class="code">
<div class="highlight"><pre>&lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">"/products/1"</span> <span class="nv">title</span><span class="o">=</span><span class="s2">"Single Post"</span>&gt;あのひと&lt;/a&gt;
&lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">"/products/2"</span> <span class="nv">title</span><span class="o">=</span><span class="s2">"Single Post"</span>&gt;海よりもまだ深く&lt;/a&gt;
&lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">"/products/3"</span> <span class="nv">title</span><span class="o">=</span><span class="s2">"Single Post"</span>&gt;ディストラクション・ベイビーズ&lt;/a&gt;
&lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">"/products/4"</span> <span class="nv">title</span><span class="o">=</span><span class="s2">"Single Post"</span>&gt;少女椿&lt;/a&gt;
// 多すぎるので以下略
</pre></div>
</td>
</tr></tbody></table>
</div>

<p class="ng-scope">この中から<code>href="リンク先"</code>の「リンク先」を抜き出しましょう。</p>

<h3 class="ng-scope">[例]</h3>

<div class="code-frame ng-scope" data-lang="php"><table class="highlighttable"><tbody><tr>
<td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td>
<td class="code">
<div class="highlight"><pre>  <span class="k">require_once</span> <span class="s1">'simple_html_dom.php'</span><span class="p">;</span>
  <span class="nv">$page</span> <span class="o">=</span> <span class="nx">file_get_html</span><span class="p">(</span><span class="s1">'http://review-movie.herokuapp.com/'</span><span class="p">);</span> <span class="c1">// movie-reviewのHTMLを取得</span>
  <span class="nv">$elements</span> <span class="o">=</span> <span class="nv">$page</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">(</span><span class="s1">'h2 a'</span><span class="p">);</span> <span class="c1">// h2要素の下のa要素を検索</span>
  <span class="k">foreach</span> <span class="p">(</span><span class="nv">$elements</span> <span class="k">as</span> <span class="nv">$ele</span><span class="p">)</span>
  <span class="p">{</span>
<span class="hll">      <span class="k">echo</span> <span class="nv">$ele</span><span class="o">-&gt;</span><span class="na">href</span><span class="p">,</span> <span class="nx">PHP_EOL</span><span class="p">;</span>
</span>  <span class="p">}</span>
</pre></div>
</td>
</tr></tbody></table></div>

<p class="ng-scope">ターミナルの出力</p>

<div class="code-frame ng-scope" data-lang="bash">
<div class="code-lang"><span class="bold">ターミナル</span></div>
<table class="highlighttable"><tbody><tr>
<td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td>
<td class="code">
<div class="highlight"><pre>/products/1
/products/2
/products/3
/products/4
// 多すぎるので以下略
</pre></div>
</td>
</tr></tbody></table>
</div>

<p class="ng-scope">ちゃんと属性<strong>href</strong>の値だけ抜き出すことができました。<br>
このようにsimple_html_domを使えばウェブサイト上のHTMLのデータを自由に取得することができます。</p>

<p class="ng-scope"><form action="http://master.tech-camp.in/curriculums/851#" data-id="3925" class="ng-pristine ng-valid ng-scope">
  <h4 class="ng-binding">
    <i class="icon check_icon_00"></i>要点チェック
  </h4>
  <!-- ngRepeat: check in checkbox.checks --><label for="check-5492" ng-repeat="check in checkbox.checks" class="ng-scope"><input id="check-5492" name="check-5492" ng-change="change_checkbox_value(check)" ng-model="check.checked" type="checkbox" class="ng-pristine ng-untouched ng-valid"><span ng-bind-html="check.text" class="ng-binding">HTML情報から属性のみを取得したい場合は、<code>-&gt;(アロー演算子)</code>を使う</span></label><!-- end ngRepeat: check in checkbox.checks -->
</form></p>

<h2 class="ng-scope" id="15">スクレイピングの手順まとめ</h2>

<p class="ng-scope">simple_html_domを使ったスクレイピングの手順をまとめましょう。</p>

<ul class="ng-scope">
<li>simple_html_dom.phpファイルを読み込む</li>
<li>simple_html_domのメソッド<strong>file_get_html(情報を取得したいウェブサイトのURL)</strong>で、ウェブサイトのHTML情報を取得する</li>
<li>欲しいデータのあるタグ要素を<strong>findメソッド</strong>で指定して取得する</li>
<li>取得したタグ要素のHTML情報にたいして<strong>plaintextメソッド</strong>、または属性を直接指定し、欲しい値を取得する</li>
</ul>

<h2 class="ng-scope" id="16">実際にスクレイピングしてみよう</h2>

<p class="ng-scope">ではこれからsimple_html_domを使って実際にスクレイピングをしてみます。ここでのスクレイピングの練習はPHPファイルを作成して行います。スクレイピング用のPHPファイル<code>scraping.php</code>をデスクトップに作成してください。</p>

<h3 class="ng-scope">
<i class="icon pen"></i> <strong>デスクトップにスクレイピング用のPHPファイル<code>scraping.php</code>を作成してください</strong>
</h3>

<p class="ng-scope">Sublime Textを選択している状態で、</p>

<p class="ng-scope">①<code>command</code> + <code>N</code>でファイルを新しく作成します。</p>

<p class="ng-scope">②<code>command</code> + <code>S</code>でファイルを保存します。</p>

<p class="ng-scope">③ファイル名を <code>scraping.php</code> と編集し、保存先にデスクトップを選択してください。</p>

<p class="ng-scope"><form action="http://master.tech-camp.in/curriculums/851#" data-id="3927" class="ng-pristine ng-valid ng-scope">
  <h4 class="ng-binding">
    <i class="icon check_icon_01"></i>作業チェック
  </h4>
  <!-- ngRepeat: check in checkbox.checks --><label for="check-5493" ng-repeat="check in checkbox.checks" class="ng-scope"><input id="check-5493" name="check-5493" ng-change="change_checkbox_value(check)" ng-model="check.checked" type="checkbox" class="ng-pristine ng-untouched ng-valid"><span ng-bind-html="check.text" class="ng-binding">デスクトップにPHPファイル<code>scraping.php</code>を作成できた</span></label><!-- end ngRepeat: check in checkbox.checks -->
</form></p>

<p class="ng-scope">では作成したPHPファイル<code>scraping.php</code>をSublime Textで開きましょう。</p>

<p class="ng-scope"><strong>simple_html_domは外部のライブラリなのでそのままでは使えません。</strong>よって、PHPタグの一番上でsimple_html_dom.phpファイルを読み込みましょう。読み込み宣言には<code>require_once</code>を使います。</p>

<h3 class="ng-scope">
<i class="icon pen"></i> <strong><code>scraping.php</code>の一番上にsimple_html_domを使うことを宣言する一行を追加しましょう</strong>
</h3>

<div class="code-frame ng-scope" data-lang="php">
<div class="code-lang"><span class="bold">scraping.php</span></div>
<table class="highlighttable"><tbody><tr>
<td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td>
<td class="code">
<div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="k">require_once</span> <span class="s1">'simple_html_dom.php'</span><span class="p">;</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</td>
</tr></tbody></table>
</div>

<p class="ng-scope">これでsimple_html_domが使えるようになりました。</p>

<p class="ng-scope"><form action="http://master.tech-camp.in/curriculums/851#" data-id="3928" class="ng-pristine ng-valid ng-scope">
  <h4 class="ng-binding">
    <i class="icon check_icon_01"></i>作業チェック
  </h4>
  <!-- ngRepeat: check in checkbox.checks --><label for="check-5494" ng-repeat="check in checkbox.checks" class="ng-scope"><input id="check-5494" name="check-5494" ng-change="change_checkbox_value(check)" ng-model="check.checked" type="checkbox" class="ng-pristine ng-untouched ng-valid"><span ng-bind-html="check.text" class="ng-binding">scraping.phpにsimple_html_dom.phpファイルを読みこませることが出来た</span></label><!-- end ngRepeat: check in checkbox.checks -->
</form></p>

<p class="ng-scope">これでスクレイピングをする準備はできました。</p>

<h2 class="ng-scope" id="17">スクレイピング練習</h2>

<p class="ng-scope">以下のスクレイピング用に用意したウェブページをスクレイピングしてみます。</p>

<p class="ng-scope"><a href="https://app-mooovi.herokuapp.com/works/initial_scraping" target="_blank">https://app-mooovi.herokuapp.com/works/initial_scraping</a></p>

<p class="ng-scope">「TEST1, TEST2, TEST3」と書いてあるだけです。この「TEST1, TEST2, TEST3」というテキストを取得しましょう。まずはこのページのHTML構造を確認します。</p>

<h3 class="ng-scope">
<i class="icon pen"></i> <strong>実際のHTMLを確認してみましょう</strong>
</h3>

<p class="ng-scope"><a href="https://app-mooovi.herokuapp.com/works/initial_scraping" target="_blank">https://app-mooovi.herokuapp.com/works/initial_scraping</a></p>

<p class="ng-scope">上記のサイトにアクセスして、[command] + [option] + [u]を押してソースコードを表示させてください。</p>

<p class="ng-scope"><img src="./スクレイピングで映画情報を取得しよう_files/02.png" alt="スクレイピング"></p>

<p class="ng-scope">“TEST1”, “TEST2”, “TEST3” は、pタグに囲まれていることがわかります。<strong>このようにスクレイピングをするときはスクレイピングしたいウェブページのHTML構造を確認することが大切です。</strong></p>

<p class="ng-scope"><form action="http://master.tech-camp.in/curriculums/851#" data-id="3929" class="ng-pristine ng-valid ng-scope">
  <h4 class="ng-binding">
    <i class="icon check_icon_01"></i>作業チェック
  </h4>
  <!-- ngRepeat: check in checkbox.checks --><label for="check-5495" ng-repeat="check in checkbox.checks" class="ng-scope"><input id="check-5495" name="check-5495" ng-change="change_checkbox_value(check)" ng-model="check.checked" type="checkbox" class="ng-pristine ng-untouched ng-valid"><span ng-bind-html="check.text" class="ng-binding">上記の画像と同じHTMLが表示された</span></label><!-- end ngRepeat: check in checkbox.checks -->
</form></p>

<p class="ng-scope">では、このウェブページからスクレイピングで「TEST1, TEST2, TEST3」を抜き出すプログラムを<code>scraping.php</code>に書きましょう。<br>
まずはfile_get_htmlメソッドでウェブページのHTMLの情報を取得します。</p>

<h3 class="ng-scope">
<i class="icon pen"></i> <strong>file_get_htmlメソッドを使ってスクレイピング用ウェブページのHTML情報を取得してください</strong>
</h3>

<p class="ng-scope">まずは、scraping.phpを以下のように編集します。</p>

<div class="code-frame ng-scope" data-lang="php">
<div class="code-lang"><span class="bold">scraping.php</span></div>
<table class="highlighttable"><tbody><tr>
<td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td>
<td class="code">
<div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="k">require_once</span> <span class="s1">'simple_html_dom.php'</span><span class="p">;</span>

<span class="hll"><span class="nv">$page</span> <span class="o">=</span> <span class="nx">file_get_html</span><span class="p">(</span><span class="s1">'http://mooovi.tech-camp.in/works/initial_scraping'</span><span class="p">);</span>
</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</td>
</tr></tbody></table>
</div>

<p class="ng-scope">HTML構造を確認すると「TEST1, TEST2, TEST3」はそれぞれ<strong>pタグ要素に囲まれています。</strong>findメソッドでpタグ要素を取得しましょう。</p>

<h3 class="ng-scope">
<i class="icon pen"></i> <strong>findメソッドを使ってHTML情報の中からpタグ要素を取得してください</strong>
</h3>

<div class="code-frame ng-scope" data-lang="php">
<div class="code-lang"><span class="bold">scraping.php</span></div>
<table class="highlighttable"><tbody><tr>
<td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td>
<td class="code">
<div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="k">require_once</span> <span class="s1">'simple_html_dom.php'</span><span class="p">;</span>

<span class="nv">$page</span> <span class="o">=</span> <span class="nx">file_get_html</span><span class="p">(</span><span class="s1">'https://app-mooovi.herokuapp.com/works/initial_scraping'</span><span class="p">);</span>
<span class="hll"><span class="nv">$elements</span> <span class="o">=</span> <span class="nv">$page</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">(</span><span class="s1">'p'</span><span class="p">);</span>
</span><span class="hll"><span class="k">foreach</span> <span class="p">(</span><span class="nv">$elements</span> <span class="k">as</span> <span class="nv">$ele</span><span class="p">)</span>
</span><span class="hll"><span class="p">{</span>
</span><span class="hll">    <span class="k">echo</span> <span class="nv">$ele</span><span class="p">,</span> <span class="nx">PHP_EOL</span><span class="p">;</span>
</span><span class="hll"><span class="p">}</span>
</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</td>
</tr></tbody></table>
</div>

<p class="ng-scope">ここまで書けたら、下記のコマンドでscraping.phpを実行します。</p>

<div class="code-frame ng-scope" data-lang="bash"><table class="highlighttable"><tbody><tr>
<td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td>
<td class="code">
<div class="highlight"><pre>  <span class="c">#Desktopに移動</span>
  <span class="nv">$ </span><span class="nb">cd</span> ~/Desktop
  <span class="c">#scraping.phpを実行</span>
  <span class="nv">$ </span>php scraping.php
</pre></div>
</td>
</tr></tbody></table></div>

<p class="ng-scope">ターミナルには以下のように表示されると思います。</p>

<div class="code-frame ng-scope" data-lang="bash"><table class="highlighttable"><tbody><tr>
<td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td>
<td class="code">
<div class="highlight"><pre>&lt;p&gt;TEST1&lt;/p&gt;
&lt;p&gt;TEST2&lt;/p&gt;
&lt;p&gt;TEST3&lt;/p&gt;
</pre></div>
</td>
</tr></tbody></table></div>

<p class="ng-scope">ちゃんとすべてのpタグ要素が取得できています。あとはplaintextメソッドでテキストを取得しましょう。</p>

<h3 class="ng-scope">
<i class="icon pen"></i> <strong>plaintextメソッドを使って「TEST1, TEST2, TEST3」を抜き出しましょう</strong>
</h3>

<div class="code-frame ng-scope" data-lang="php">
<div class="code-lang"><span class="bold">scraping.php</span></div>
<table class="highlighttable"><tbody><tr>
<td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td>
<td class="code">
<div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="k">require_once</span> <span class="s1">'simple_html_dom.php'</span><span class="p">;</span>

<span class="nv">$page</span> <span class="o">=</span> <span class="nx">file_get_html</span><span class="p">(</span><span class="s1">'https://app-mooovi.herokuapp.com/works/initial_scraping'</span><span class="p">);</span>
<span class="nv">$elements</span> <span class="o">=</span> <span class="nv">$page</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">(</span><span class="s1">'p'</span><span class="p">);</span>
<span class="hll"><span class="k">foreach</span> <span class="p">(</span><span class="nv">$elements</span> <span class="k">as</span> <span class="nv">$ele</span><span class="p">)</span>
</span><span class="hll"><span class="p">{</span>
</span><span class="hll">    <span class="k">echo</span> <span class="nv">$ele</span><span class="o">-&gt;</span><span class="na">plaintext</span><span class="p">,</span> <span class="nx">PHP_EOL</span><span class="p">;</span>
</span><span class="hll"><span class="p">}</span>
</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</td>
</tr></tbody></table>
</div>

<p class="ng-scope"><strong>pタグ要素は複数あるのでforeach関数を使ってインスタンス一つ一つにたいしてplaintextメソッドを使います。</strong>このプログラムを実行すると以下のようにターミナルに表示されます。</p>

<div class="code-frame ng-scope" data-lang="bash"><table class="highlighttable"><tbody><tr>
<td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td>
<td class="code">
<div class="highlight"><pre>TEST1
TEST2
TEST3
</pre></div>
</td>
</tr></tbody></table></div>

<p class="ng-scope">テキスト「TEST1, TEST2, TEST3」が取得できました。</p>

<p class="ng-scope"><form action="http://master.tech-camp.in/curriculums/851#" data-id="3930" class="ng-pristine ng-valid ng-scope">
  <h4 class="ng-binding">
    <i class="icon check_icon_01"></i>作業チェック
  </h4>
  <!-- ngRepeat: check in checkbox.checks --><label for="check-5496" ng-repeat="check in checkbox.checks" class="ng-scope"><input id="check-5496" name="check-5496" ng-change="change_checkbox_value(check)" ng-model="check.checked" type="checkbox" class="ng-pristine ng-untouched ng-valid"><span ng-bind-html="check.text" class="ng-binding">スクレイピングで指定のウェブサイトからテキスト「TEST1, TEST2, TEST3」を抜き出せた</span></label><!-- end ngRepeat: check in checkbox.checks -->
</form></p>

<h2 class="ng-scope" id="18">練習問題を解いてみよう</h2>

<p class="ng-scope">各問題用のウェブサイトには、「Q0-TEST0」といったテキストが書かれています。それらは問題ごとにHTMLの構造が異なります。HTML構造を確認しながら、表示されている文字列から該当するものをスクレイピングで取得しましょう。</p>

<p class="ng-scope">作業ファイルは<code>scraping.php</code>です。問題ごとにそれまで書いていたソースコードは全て消して新しく書いていきましょう。</p>

<div class="challenge ng-scope">
  <h3>
<i class="icon crown"></i> 問題1：この<a href="https://app-mooovi.herokuapp.com/works/first_scraping" alt="サイト1" target="_blank">サイト1</a>からスクレイピングを使って文字列を"Q1-TEST1", "Q1-TEST2", "Q1-TEST3"をすべて取得してみましょう</h3>
  <div class="challenge_box">
    <h5>作業ファイル：scraping.php</h5>
    <h5>ヒント：特になし</h5>
    <curriculum-question-container data-order="1" class="ng-scope"><button class="answer ng-hide" ng-click="show_answer()" ng-show="isSolved">解答と解説を見る</button><button class="solve ng-binding" ng-click="solve()" ng-hide="isSolved">課題を解く</button><button class="solved ng-hide" ng-click="solved()" ng-show="isSolving">解けた</button>
</curriculum-question-container>
  </div>
</div>

<p class="ng-scope"><form action="http://master.tech-camp.in/curriculums/851#" data-id="3944" class="ng-pristine ng-valid ng-scope">
  <h4 class="ng-binding">
    <i class="icon check_icon_02"></i>課題チェック
  </h4>
  <!-- ngRepeat: check in checkbox.checks --><label for="check-6859" ng-repeat="check in checkbox.checks" class="ng-scope"><input id="check-6859" name="check-6859" ng-change="change_checkbox_value(check)" ng-model="check.checked" type="checkbox" class="ng-pristine ng-untouched ng-valid"><span ng-bind-html="check.text" class="ng-binding">この<a href="https://app-mooovi.herokuapp.com/works/first_scraping" title="first_scraping">サイト1</a>から文字列"TEST1", "TEST2", "TEST3"を取得できた</span></label><!-- end ngRepeat: check in checkbox.checks -->
</form></p>

<div class="challenge ng-scope">
  <h3>
<i class="icon crown"></i> 問題2：この<a href="https://app-mooovi.herokuapp.com/works/second_scraping" alt="サイト2" target="_blank">サイト2</a>からスクレイピングを使って文字列を"Q2-TEST1", "Q2-TEST2", "Q2-TEST3"をすべて取得してみましょう</h3>
  <div class="challenge_box">
    <h5>作業ファイル：scraping.php</h5>
    <h5>ヒント：特になし</h5>
    <curriculum-question-container data-order="2" class="ng-scope"><button class="answer ng-hide" ng-click="show_answer()" ng-show="isSolved">解答と解説を見る</button><button class="solve ng-binding" ng-click="solve()" ng-hide="isSolved">課題を解く</button><button class="solved ng-hide" ng-click="solved()" ng-show="isSolving">解けた</button>
</curriculum-question-container>
  </div>
</div>

<p class="ng-scope"><form action="http://master.tech-camp.in/curriculums/851#" data-id="4247" class="ng-pristine ng-valid ng-scope">
  <h4 class="ng-binding">
    <i class="icon check_icon_01"></i>作業チェック
  </h4>
  <!-- ngRepeat: check in checkbox.checks --><label for="check-5927" ng-repeat="check in checkbox.checks" class="ng-scope"><input id="check-5927" name="check-5927" ng-change="change_checkbox_value(check)" ng-model="check.checked" type="checkbox" class="ng-pristine ng-untouched ng-valid"><span ng-bind-html="check.text" class="ng-binding">この<a href="https://app-mooovi.herokuapp.com/works/second_scraping" title="second_scraping">サイト2</a>から文字列"TEST1", "TEST2", "TEST3"を取得できた</span></label><!-- end ngRepeat: check in checkbox.checks -->
</form></p>

<div class="challenge ng-scope">
  <h3>
<i class="icon crown"></i> 問題3：この<a href="https://app-mooovi.herokuapp.com/works/third_scraping" alt="サイト3" target="_blank">サイト3</a>からスクレイピングを使って文字列を"Q3-TEST1", "Q3-TEST2", "Q3-TEST3"のみを取得してみましょう</h3>
  <div class="challenge_box">
    <h5>作業ファイル：scraping.php</h5>
    <h5>ヒント：CSSと同じように('.クラス名')でクラスを指定できます。</h5>
    <curriculum-question-container data-order="3" class="ng-scope"><button class="answer ng-hide" ng-click="show_answer()" ng-show="isSolved">解答と解説を見る</button><button class="solve ng-binding" ng-click="solve()" ng-hide="isSolved">課題を解く</button><button class="solved ng-hide" ng-click="solved()" ng-show="isSolving">解けた</button>
</curriculum-question-container>
  </div>
</div>

<p class="ng-scope"><form action="http://master.tech-camp.in/curriculums/851#" data-id="4248" class="ng-valid ng-scope ng-dirty ng-valid-parse">
  <h4 class="ng-binding">
    <i class="icon check_icon_01"></i>作業チェック
  </h4>
  <!-- ngRepeat: check in checkbox.checks --><label for="check-5928" ng-repeat="check in checkbox.checks" class="ng-scope"><input id="check-5928" name="check-5928" ng-change="change_checkbox_value(check)" ng-model="check.checked" type="checkbox" class="ng-valid ng-dirty ng-valid-parse ng-touched"><span ng-bind-html="check.text" class="ng-binding">この<a href="https://app-mooovi.herokuapp.com/works/third_scraping" title="third_scraping">サイト3</a>から文字列"TEST1", "TEST2", "TEST3"を取得できた</span></label><!-- end ngRepeat: check in checkbox.checks -->
</form></p>

<h1 class="ng-scope" id="19">movie-reviewからのスクレイピング</h1>

<p class="ng-scope">movie-reviewから映画のデータを取得しましょう。ページへは以下のリンクから遷移できます。</p>

<p class="ng-scope"><a href="http://review-movie.herokuapp.com/" target="_blank">http://review-movie.herokuapp.com/</a></p>

<p class="ng-scope">このページには20件の映画情報が載っています。まずはこのページにある<strong>20件の映画情報をスクレイピングで取得しましょう。</strong></p>

<h2 class="ng-scope" id="20">作品名、作品画像のURLを取得しよう</h2>

<p class="ng-scope">映画の情報と言っても作品名、監督名、公開日など様々なものがありますが、とりあえず今回は最低限の情報として<strong>「作品名」</strong>と<strong>「作品画像のURL」</strong>を取得しましょう。</p>

<p class="ng-scope"><img src="./スクレイピングで映画情報を取得しよう_files/35f3557f38aee470169d3d8562f8529f.png" alt="https://tech-master.s3.amazonaws.com/uploads/curriculums//35f3557f38aee470169d3d8562f8529f.png"></p>

<h2 class="ng-scope" id="21">映画情報のスクレイピング用のPHPファイルを作ろう</h2>

<p class="ng-scope">映画の「作品名」と「作品画像のURL」を取得するスクレイピングのプログラムを書くためのPHPファイルを作成しましょう。作品名のスクレイピング用のPHPファイル<code>scraping_title.php</code> 、作品画像のスクレイピング用のPHPファイル<code>scraping_image.php</code> 、をデスクトップに作成してください。</p>

<h3 class="ng-scope">
<i class="icon pen"></i> <strong>デスクトップにスクレイピング用のPHPファイル<code>scraping_title.php</code>と<code>scraping_image.php</code>を作成してください</strong>
</h3>

<p class="ng-scope"><form action="http://master.tech-camp.in/curriculums/851#" data-id="3934" class="ng-valid ng-scope ng-dirty ng-valid-parse">
  <h4 class="ng-binding">
    <i class="icon check_icon_01"></i>作業チェック
  </h4>
  <!-- ngRepeat: check in checkbox.checks --><label for="check-5500" ng-repeat="check in checkbox.checks" class="ng-scope"><input id="check-5500" name="check-5500" ng-change="change_checkbox_value(check)" ng-model="check.checked" type="checkbox" class="ng-valid ng-dirty ng-valid-parse ng-touched"><span ng-bind-html="check.text" class="ng-binding">デスクトップにPHPファイル<code>scraping_title.php</code>と<code>scraping_image.php</code>を作成できた</span></label><!-- end ngRepeat: check in checkbox.checks -->
</form></p>

<h2 class="ng-scope" id="22">ウェブサイトのHTML構造を確認しよう</h2>

<p class="ng-scope">まずはスクレイピングするウェブサイトのHTML構造を調べてみましょう。</p>

<h3 class="ng-scope">
<i class="icon pen"></i> <strong>スクレイピングするページにウェブブラウザでアクセスして、HTMLを確認して下さい</strong>
</h3>

<p class="ng-scope"><a href="http://review-movie.herokuapp.com/" target="_blank">http://review-movie.herokuapp.com/</a></p>

<h3 class="ng-scope">
<i class="icon pen"></i> <strong>作品名のHTML構造を確認しよう</strong>
</h3>

<p class="ng-scope"><strong>開発者ツールを使えば、HTMLが見やすいです</strong></p>

<ol class="ng-scope">
<li>作品名や作品画像を右クリック</li>
<li>[要素の検証]をクリックして開発者ツールを立ち上げる</li>
<li>HTMLが見やすく整形されて表示される
<img src="./スクレイピングで映画情報を取得しよう_files/1aa402fdc88000666534a7140addc987.png" alt="https://tech-master.s3.amazonaws.com/uploads/curriculums//1aa402fdc88000666534a7140addc987.png">
</li>
</ol>

<p class="ng-scope"><form action="http://master.tech-camp.in/curriculums/851#" data-id="3935" class="ng-valid ng-scope ng-dirty ng-valid-parse">
  <h4 class="ng-binding">
    <i class="icon check_icon_01"></i>作業チェック
  </h4>
  <!-- ngRepeat: check in checkbox.checks --><label for="check-5501" ng-repeat="check in checkbox.checks" class="ng-scope"><input id="check-5501" name="check-5501" ng-change="change_checkbox_value(check)" ng-model="check.checked" type="checkbox" class="ng-valid ng-dirty ng-valid-parse ng-touched"><span ng-bind-html="check.text" class="ng-binding">画像のような開発者ツールが表示された</span></label><!-- end ngRepeat: check in checkbox.checks -->
</form></p>

<h2 class="ng-scope" id="23">作品名を取得しよう①</h2>

<p class="ng-scope">まずは、開発者ツールを利用して作品名がある要素のHTML構造を確認しましょう。</p>

<h3 class="ng-scope">
<i class="icon pen"></i> <strong>Chromeの開発者ツールを使って下記のようなHTML構造を確認しましょう</strong>
</h3>

<p class="ng-scope">HTMLを確認してみると、作品名はどこに存在するかというのがわかるとおもいます。</p>

<p class="ng-scope"><img src="./スクレイピングで映画情報を取得しよう_files/6477b658f8fde2a7fe3a13311560bf52.png" alt="https://tech-master.s3.amazonaws.com/uploads/curriculums//6477b658f8fde2a7fe3a13311560bf52.png"></p>

<p class="ng-scope">あとは、このHTML構造にたいしてスクレイピングのプログラムを書くだけです。作業ファイルは<code>scraping_title.php</code>です。</p>

<div class="challenge ng-scope">
  <h3>
<i class="icon crown"></i> 問題4：<a href="http://review-movie.herokuapp.com/" alt="movie-review" target="_blank">movie-review</a>に表示されている映画20件の「作品名」を取得しましょう</h3>
  <div class="challenge_box">
    <h5>作業ファイル：scraping_title.php</h5>
    <h5>ヒント：開発者ツールで確認したHTMLのタグ要素をfindメソッドの引数にしましょう</h5>
    <curriculum-question-container data-order="4" class="ng-scope"><button class="answer" ng-click="show_answer()" ng-show="isSolved">解答と解説を見る</button><button class="solve ng-binding ng-hide" ng-click="solve()" ng-hide="isSolved">残り時間 18分 52秒</button><button class="solved ng-hide" ng-click="solved()" ng-show="isSolving">解けた</button>
</curriculum-question-container>
  </div>
</div>

<p class="ng-scope"><form action="http://master.tech-camp.in/curriculums/851#" data-id="4249" class="ng-valid ng-scope ng-dirty ng-valid-parse">
  <h4 class="ng-binding">
    <i class="icon check_icon_01"></i>作業チェック
  </h4>
  <!-- ngRepeat: check in checkbox.checks --><label for="check-5929" ng-repeat="check in checkbox.checks" class="ng-scope"><input id="check-5929" name="check-5929" ng-change="change_checkbox_value(check)" ng-model="check.checked" type="checkbox" class="ng-valid ng-dirty ng-valid-parse ng-touched"><span ng-bind-html="check.text" class="ng-binding">movie-reviewから映画20件の作品名を取得できた</span></label><!-- end ngRepeat: check in checkbox.checks -->
</form></p>

<h2 class="ng-scope" id="24">作品画像のURLを取得しよう</h2>

<p class="ng-scope">作品名が取得できたので、次は作品画像のURLを取得しましょう。<br>
先ほどのように画像に対して開発者ツールの<strong>要素の検証</strong>をして、HTMLの構造を確認しましょう。作業ファイルは<code>scraping_image.php</code>です。</p>

<p class="ng-scope"><img src="./スクレイピングで映画情報を取得しよう_files/1d09da4ecbd83511707fb46408bb1a0a.png" alt="https://tech-master.s3.amazonaws.com/uploads/curriculums//1d09da4ecbd83511707fb46408bb1a0a.png"></p>

<p class="ng-scope">では、作品名と同じように表示されている20件の映画の作品画像URLをスクレイピングで取得しましょう。</p>

<div class="challenge ng-scope">
  <h3>
<i class="icon crown"></i> 問題5：<a href="http://review-movie.herokuapp.com/" alt="movie-review" target="_blank">movie-review</a>に表示されている映画20件の「作品画像のURL」を取得しましょう</h3>
  <div class="challenge_box">
    <h5>作業ファイル：scraping_image.php</h5>
    <h5>ヒント：取得するのはテキストでなく属性の値です</h5>
    <curriculum-question-container data-order="5" class="ng-scope"><button class="answer" ng-click="show_answer()" ng-show="isSolved">解答と解説を見る</button><button class="solve ng-binding ng-hide" ng-click="solve()" ng-hide="isSolved">残り時間 16分 06秒</button><button class="solved ng-hide" ng-click="solved()" ng-show="isSolving">解けた</button>
</curriculum-question-container>
  </div>
</div>

<p class="ng-scope"><form action="http://master.tech-camp.in/curriculums/851#" data-id="4250" class="ng-valid ng-scope ng-dirty ng-valid-parse">
  <h4 class="ng-binding">
    <i class="icon check_icon_01"></i>作業チェック
  </h4>
  <!-- ngRepeat: check in checkbox.checks --><label for="check-5930" ng-repeat="check in checkbox.checks" class="ng-scope"><input id="check-5930" name="check-5930" ng-change="change_checkbox_value(check)" ng-model="check.checked" type="checkbox" class="ng-valid ng-dirty ng-valid-parse ng-touched"><span ng-bind-html="check.text" class="ng-binding">movie_reviewから映画20県の作品画像のURLを取得できた</span></label><!-- end ngRepeat: check in checkbox.checks -->
</form></p>

<h2 class="ng-scope" id="25">作品画像のURLを取得しよう②</h2>

<p class="ng-scope">作品画像のURLを取得することができました。では試しに取得できた画像を開いてみてください。<br>
画像が小さいですね。あとカバー写真というよりは映画のワンシーンのような画像です。これでは表示させるとき少し物足りないです。</p>

<p class="ng-scope">そこでちゃんとした作品画像を取り直しましょう。<a href="http://review-movie.herokuapp.com/" target="_blank">movie-review</a>でどれかの映画タイトルをクリックしてみましょう。その映画の個別ページに移動しました。そこに良さそうな画像があります。</p>

<p class="ng-scope"><img src="./スクレイピングで映画情報を取得しよう_files/c90e392eabf0af6b048d7937bdf8423b.png" alt="https://tech-master.s3.amazonaws.com/uploads/curriculums//c90e392eabf0af6b048d7937bdf8423b.png"></p>

<p class="ng-scope">この作品画像を取得しましょう。</p>

<h2 class="ng-scope" id="26">個別ページの作品画像のURLを取得しよう</h2>

<p class="ng-scope">では、まず<a href="http://review-movie.herokuapp.com/" target="_blank">movie-review</a>に表示されている映画ならどれでもいいので個別ページに移動しましょう。</p>

<p class="ng-scope"><img src="./スクレイピングで映画情報を取得しよう_files/0446cd57ca703edc1d16b7e7a5048c05.png" alt="https://tech-master.s3.amazonaws.com/uploads/curriculums//0446cd57ca703edc1d16b7e7a5048c05.png"></p>

<p class="ng-scope">移動できたらそのページの作品画像URLを取得してみましょう。作業ファイルは<code>scraping_image.php</code>です。先ほど書いたソースコードは使わないので消してしまいましょう。</p>

<div class="challenge ng-scope">
  <h3>
<i class="icon crown"></i> 問題6：映画の個別ページに表示されている映画の「作品画像のURL」を取得しましょう</h3>
  <div class="challenge_box">
    <h5>作業ファイル：scraping_image.php</h5>
    <h5>ヒント：リンクは各自開いた映画の個別ページのものを使いましょう</h5>
    <curriculum-question-container data-order="6" class="ng-scope"><button class="answer" ng-click="show_answer()" ng-show="isSolved">解答と解説を見る</button><button class="solve ng-binding ng-hide" ng-click="solve()" ng-hide="isSolved">残り時間 27分 42秒</button><button class="solved ng-hide" ng-click="solved()" ng-show="isSolving">解けた</button>
</curriculum-question-container>
  </div>
</div>

<p class="ng-scope"><form action="http://master.tech-camp.in/curriculums/851#" data-id="4251" class="ng-valid ng-scope ng-dirty ng-valid-parse">
  <h4 class="ng-binding">
    <i class="icon check_icon_01"></i>作業チェック
  </h4>
  <!-- ngRepeat: check in checkbox.checks --><label for="check-5931" ng-repeat="check in checkbox.checks" class="ng-scope"><input id="check-5931" name="check-5931" ng-change="change_checkbox_value(check)" ng-model="check.checked" type="checkbox" class="ng-valid ng-dirty ng-valid-parse ng-touched"><span ng-bind-html="check.text" class="ng-binding">映画の個別ページに表示されている作品画像のURLを取得できた</span></label><!-- end ngRepeat: check in checkbox.checks -->
</form></p>

<h2 class="ng-scope" id="27">20件分すべての映画の個別ページから作品画像のURLを取得しよう</h2>

<p class="ng-scope">先ほどは<a href="http://review-movie.herokuapp.com/" target="_blank">movie-review</a>で表示されている20件の映画の中から1つだけ選んで、その個別ページから作品画像のURLを取得しました。</p>

<p class="ng-scope"><strong>次は20件すべての映画の個別ページから作品画像のURLを取得しましょう。</strong>もちろんすべてプログラムで自動で取得します。</p>

<p class="ng-scope">以下のような流れでスクレイピングをします。</p>

<ol class="ng-scope">
<li>
<a href="http://review-movie.herokuapp.com/" target="_blank">movie-review</a>で表示されている映画の個別ページのリンクを取得する</li>
<li>取得した個別ページのリンク１つ１つに対してスクレイピングをする</li>
</ol>

<p class="ng-scope">以下のようにスクレイピングのプログラムを書きましょう。</p>

<div class="code-frame ng-scope" data-lang="php">
<div class="code-lang"><span class="bold">scraping_image.php</span></div>
<table class="highlighttable"><tbody><tr>
<td class="linenos"><div class="linenodiv"><pre>10
11
12
13
14
15
16
17
18
19
20
21
22
23</pre></div></td>
<td class="code">
<div class="highlight"><pre><span class="o">&lt;?</span>

<span class="k">require_once</span> <span class="p">(</span><span class="s1">'simple_html_dom.php'</span><span class="p">);</span>

<span class="nv">$links</span> <span class="o">=</span> <span class="k">array</span><span class="p">;</span>  <span class="c1">// 個別ページのリンクを保存する配列</span>
<span class="nv">$current_page</span> <span class="o">=</span> <span class="nx">file_get_html</span><span class="p">(</span><span class="s1">'http://review-movie.herokuapp.com/'</span><span class="p">);</span>
<span class="c1">// 個別ページのリンクを取得</span>

<span class="k">foreach</span> <span class="p">(</span><span class="nv">$links</span> <span class="k">as</span> <span class="nv">$link</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// 個別ページから作品画像のURLを取得</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</td>
</tr></tbody></table>
</div>

<div class="challenge ng-scope">
  <h3>
<i class="icon crown"></i> 問題7：<a href="http://review-movie.herokuapp.com/" alt="movie-review" target="_blank">movie-review</a>にある20件の映画すべての個別ページから作品画像のURLを取得しましょう</h3>
  <div class="challenge_box">
    <h5>作業ファイル：scraping_image.php</h5>
    <h5>ヒント1：映画で表示されている映画の個別ページのリンクを取得する</h5>
    <h5>ヒント2：取得した個別ページのリンク１つ１つに対してスクレイピングをする</h5>

    <curriculum-question-container data-order="7" class="ng-scope"><button class="answer" ng-click="show_answer()" ng-show="isSolved">解答と解説を見る</button><button class="solve ng-binding ng-hide" ng-click="solve()" ng-hide="isSolved">残り時間 22分 58秒</button><button class="solved ng-hide" ng-click="solved()" ng-show="isSolving">解けた</button>
</curriculum-question-container>
  </div>
</div>

<p class="ng-scope"><form action="http://master.tech-camp.in/curriculums/851#" data-id="4252" class="ng-valid ng-scope ng-dirty ng-valid-parse">
  <h4 class="ng-binding">
    <i class="icon check_icon_01"></i>作業チェック
  </h4>
  <!-- ngRepeat: check in checkbox.checks --><label for="check-5932" ng-repeat="check in checkbox.checks" class="ng-scope"><input id="check-5932" name="check-5932" ng-change="change_checkbox_value(check)" ng-model="check.checked" type="checkbox" class="ng-valid ng-dirty ng-valid-parse ng-touched"><span ng-bind-html="check.text" class="ng-binding">20件の映画すべての個別ページから作品画像のURLを取得できた</span></label><!-- end ngRepeat: check in checkbox.checks -->
</form></p>

<h1 class="ng-scope" id="28">データベースに映画のデータを保存しよう</h1>

<p class="ng-scope">これで映画レビューサイトで必要な映画の情報「作品名」と「作品画像」がスクレイピングで取得できました。あとは得たこの情報をデータベースに入れるだけです。 <strong>ここからは映画レビューアプリケーションのディレクトリ<code>mooovi</code>で作業をしましょう。</strong></p>

<h2 class="ng-scope" id="29">映画情報のモデルを作成しよう</h2>

<p class="ng-scope">映画の情報を扱うモデルとして<strong>Productモデル</strong>を作成しましょう。このProductモデルに対応するproductsテーブルは以下のカラムを持っています。</p>

<table class="ng-scope">
<thead>
<tr>
<th style="text-align: center">カラム名</th>
<th style="text-align: center">型</th>
<th style="text-align: center">情報</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center">title</td>
<td style="text-align: center">String</td>
<td style="text-align: center">作品名</td>
</tr>
<tr>
<td style="text-align: center">image_url</td>
<td style="text-align: center">Text</td>
<td style="text-align: center">作品画像のURL</td>
</tr>
</tbody>
</table>

<p class="ng-scope"><br></p>

<p class="ng-scope">では、Productモデルと上記のカラムを持ったproductsテーブルを作成しましょう。</p>

<div class="challenge ng-scope">
  <h3>
<i class="icon crown"></i> 問題8：Productモデルと映画レビューアプリケーションmoooviに指定したカラムを持つproductテーブルを作成しましょう</h3>
  <div class="challenge_box">
    <h5>作業ディレクトリ：mooovi</h5>
    <h5>ヒント：特になし</h5>
    <curriculum-question-container data-order="8" class="ng-scope"><button class="answer" ng-click="show_answer()" ng-show="isSolved">解答と解説を見る</button><button class="solve ng-binding ng-hide" ng-click="solve()" ng-hide="isSolved">残り時間 29分 40秒</button><button class="solved ng-hide" ng-click="solved()" ng-show="isSolving">解けた</button>
</curriculum-question-container>
  </div>
</div>

<p class="ng-scope"><form action="http://master.tech-camp.in/curriculums/851#" data-id="4253" class="ng-valid ng-scope ng-dirty ng-valid-parse">
  <h4 class="ng-binding">
    <i class="icon check_icon_01"></i>作業チェック
  </h4>
  <!-- ngRepeat: check in checkbox.checks --><label for="check-5933" ng-repeat="check in checkbox.checks" class="ng-scope"><input id="check-5933" name="check-5933" ng-change="change_checkbox_value(check)" ng-model="check.checked" type="checkbox" class="ng-valid ng-dirty ng-valid-parse ng-touched"><span ng-bind-html="check.text" class="ng-binding">映画情報を持つProductモデルが作成できた</span></label><!-- end ngRepeat: check in checkbox.checks -->
</form></p>

<h2 class="ng-scope" id="30">映画情報をデータベースに保存するメソッドを書こう</h2>

<p class="ng-scope">では、今まで書いてきたスクレイピングのメソッドを利用して「movie-review」から映画情報を取得し、データベースに保存するメソッドを書きましょう。</p>

<p class="ng-scope">先ほどまではDesktopにPHPファイルを作って実行していますが、今回は取得した情報をデータベースへ保存する必要があるので<code>mooovi</code>ディレクトリの中にファイルを作成し、ソースコードを書いていきます。</p>

<h3 class="ng-scope">
<i class="icon pen"></i> 下記に従い、Scraping.phpを作成しましょう</h3>

<p class="ng-scope"><img src="./スクレイピングで映画情報を取得しよう_files/977d2a46c7d56f34a83d33bfc66479f0.png" alt="https://tech-master.s3.amazonaws.com/uploads/curriculums//977d2a46c7d56f34a83d33bfc66479f0.png"></p>

<p class="ng-scope"><strong>mooovi &gt; app ** 内に</strong>Scraping.php**というファイルを作成します。</p>

<p class="ng-scope">この時、sublime text上から直接ファイルを作成します。</p>

<p class="ng-scope">①「mooovi」&gt;「app」を右クリックし、「new file」を選択しましょう</p>

<p class="ng-scope"><img src="./スクレイピングで映画情報を取得しよう_files/bc6ec43cbda1e3367431e66fd7904abe.png" alt="選択ツールnewfile"></p>

<p class="ng-scope">下記のように「untitled」という空のファイルが開かれます。</p>

<p class="ng-scope"><img src="./スクレイピングで映画情報を取得しよう_files/103.png" alt="作成されるファイル"></p>

<p class="ng-scope">②「⌘ (コマンド)+ sキー」を実行し、ファイル保存画面を開きましょう</p>

<p class="ng-scope"><img src="./スクレイピングで映画情報を取得しよう_files/0a7064cb2c937dbfa54211414eb7a23e.png" alt="save画面"></p>

<p class="ng-scope">③「Scraping.php」というファイル名で保存しましょう</p>

<p class="ng-scope">その後、以下のようなディレクトリ構造になっていることを確認してください。</p>

<ul class="filetree ng-scope">
  <li class="t-folder"> app
    <ul>
      <li class="t-file"> Scraping.php</li>
      </ul>
</li>
    </ul>
  


<p class="ng-scope">また、同じディレクトリ上にスクレイピング用のファイル<code>simple_html_dom.php</code>を配置する必要があります。</p>

<h3 class="ng-scope">
<i class="icon pen"></i> 下記に従い、simple_html_dom.phpファイルを配置しましょう</h3>

<p class="ng-scope">もう一度<a href="https://sourceforge.net/projects/simplehtmldom/files/" target="_blank">こちらのサイト</a>からファイルをダウンロードしましょう。ダウンロードできたら以下のようなファイル構造になるようにsimple_html_dom.phpファイルを配置してください。先ほど作成した<code>Scraping.php</code>ファイルと同じ階層です。</p>

<ul class="filetree ng-scope">
  <li class="t-folder">mooovi
    <ul>
      <li class="t-folder"> app
        <ul>
          <li class="t-folder"> Console </li>
          <li class="t-folder"> Events </li>
          <li class="t-folder"> Exceptions </li>
          <li class="t-folder"> Http </li>
          <li class="t-folder"> Jobs </li>
          <li class="t-folder"> Listeners </li>
          <li class="t-folder"> Policies </li>
          <li class="t-folder"> Providers </li>
          <li class="t-file"> Scraping.php </li>
          <li class="t-file"> simple_html_dom.php </li>
          <li class="t-file"> User.php </li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<h2 class="ng-scope" id="31">記述するメソッドと実行方法</h2>

<h3 class="ng-scope">
<i class="icon pen"></i> スクレイピングのためのコードを記述しましょう</h3>

<p class="ng-scope">先ほど作成した<code>Scraping.php</code>というファイルにスクレイピング関連のメソッドを記述していきます。</p>

<p class="ng-scope">下記のように編集してください。</p>

<div class="code-frame ng-scope" data-lang="php">
<div class="code-lang"><span class="bold">Scraping.php</span></div>
<table class="highlighttable"><tbody><tr>
<td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20</pre></div></td>
<td class="code">
<div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Scraping</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">movie_urls</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">echo</span> <span class="s2">"get movies link URL</span><span class="se">\n</span><span class="s2">"</span><span class="p">;</span>
        <span class="c1">// ここに処理を書く</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">get_product</span><span class="p">(</span><span class="nv">$link</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">echo</span> <span class="s2">"get movie information</span><span class="se">\n</span><span class="s2">"</span><span class="p">;</span>
        <span class="c1">// ここに処理を書く</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</td>
</tr></tbody></table>
</div>

<p class="ng-scope">静的メソッド<code>movie_urls()</code>と<code>get_product()</code>がありますね。この中に具体的な処理を書いていきます。</p>

<p class="ng-scope">この静的メソッド<code>movie_urls()</code>をターミナルから実行させたいです。これまで通り<code>php app/Scraping.php</code>とすると、今は問題ないですが、後ほどproductsテーブルにデータを保存する処理を記述した場合にエラーが出てしまいます。ターミナルからファイルを処理する場合データベース接続ができません。</p>

<p class="ng-scope">そこで、movie_urls()メソッドを実行させるためのコマンドを自作する必要があります。Laravelではコマンド作成が簡単に実装できるようになっています。</p>

<p class="ng-scope"><form action="http://master.tech-camp.in/curriculums/851#" data-id="3941" class="ng-valid ng-scope ng-dirty ng-valid-parse">
  <h4 class="ng-binding">
    <i class="icon check_icon_01"></i>作業チェック
  </h4>
  <!-- ngRepeat: check in checkbox.checks --><label for="check-5942" ng-repeat="check in checkbox.checks" class="ng-scope"><input id="check-5942" name="check-5942" ng-change="change_checkbox_value(check)" ng-model="check.checked" type="checkbox" class="ng-valid ng-dirty ng-valid-parse ng-touched"><span ng-bind-html="check.text" class="ng-binding"> 「mooovi」&lt;&lt;「app」ディレクトリ配下に<code>Scraping.php</code>ファイルを作成できた</span></label><!-- end ngRepeat: check in checkbox.checks -->
</form></p>

<h2 class="ng-scope" id="32">スクレイピング実行のためのコマンドを作成しよう</h2>

<p class="ng-scope">今回作成するコマンドはスクレイピングを実行するためのコマンドなので、名前は<code>movie_scraping</code>コマンドにします。従って<code>$php artisan movie_scraping</code>とターミナルに打ち込むと、Scraping.phpファイルのmovie_urls()メソッドが実行されることをゴールとします。</p>

<p class="ng-scope">自作コマンド生成のための手順は以下です。<br>
①コマンド操作のためのファイル作成<br>
②作成したコマンド操作のファイルをアプリケーションに登録<br>
③コマンドの実行内容を記入する<br>
④自作したコマンドを実行</p>

<h3 class="ng-scope">①コマンド操作のためのファイル作成</h3>

<p class="ng-scope">まずは、コマンド操作のためのファイルを作成します。ファイルは<code>php artisan make:consoleコマンド</code>で作成することができます。</p>

<h3 class="ng-scope">
<i class="icon information" id="term_386"></i> php artisan make:consoleコマンド</h3>

<p class="ng-scope">新しいコマンドを作成するためのひな形を生成するコマンドです。作成したコマンドは <code>php artisan コマンド名</code>という形で使うことが出来ます。また、commandオプションを指定することで、コマンドが登録された状態でファイルを作成できます。</p>

<h3 class="ng-scope">[例]</h3>

<div class="code-frame ng-scope" data-lang="bash">
<div class="code-lang"><span class="bold">ターミナル</span></div>
<table class="highlighttable"><tbody><tr>
<td class="linenos"><div class="linenodiv"><pre>1</pre></div></td>
<td class="code">
<div class="highlight"><pre><span class="nv">$ </span>php artisan make:console ファイル名 --command<span class="o">=</span>登録したいコマンド名
</pre></div>
</td>
</tr></tbody></table>
</div>

<h3 class="ng-scope">
<i class="icon pen"></i> ターミナルで以下のコマンドを実行してみましょう</h3>

<div class="code-frame ng-scope" data-lang="bash">
<div class="code-lang"><span class="bold">ターミナル</span></div>
<table class="highlighttable"><tbody><tr>
<td class="linenos"><div class="linenodiv"><pre>1</pre></div></td>
<td class="code">
<div class="highlight"><pre><span class="nv">$ </span>php artisan make:console MovieScraping --command<span class="o">=</span>movie_scraping
</pre></div>
</td>
</tr></tbody></table>
</div>

<p class="ng-scope">以下のようにCommandsディレクトリ配下にMovieScraping.phpファイルが作成されたことが確認できるかと思います。</p>

<ul class="filetree ng-scope">
  <li class="t-folder">mooovi
    <ul>
      <li class="t-folder"> app
        <ul>
          <li class="t-folder"> Console
          <ul>
            <li class="t-folder"> Commands
            <ul>
              <li class="t-file"> Inspire.php </li>
              <li class="t-file"> MovieScraping.php </li>
          </ul>
           </li>
        </ul>
        </li>
      </ul>
</li>
    </ul>
  </li>
</ul>

<p class="ng-scope">ファイルの中身は以下のようになっています。</p>

<div class="code-frame ng-scope" data-lang="php">
<div class="code-lang"><span class="bold">MovieScraping.php</span></div>
<table class="highlighttable"><tbody><tr>
<td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42</pre></div></td>
<td class="code">
<div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Console\Commands</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Console\Command</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">MovieScraping</span> <span class="k">extends</span> <span class="nx">Command</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * The name and signature of the console command.</span>
<span class="sd">     *</span>
<span class="sd">     * @var string</span>
<span class="sd">     */</span>
    <span class="k">protected</span> <span class="nv">$signature</span> <span class="o">=</span> <span class="s1">'movie_scraping'</span><span class="p">;</span>

    <span class="sd">/**</span>
<span class="sd">     * The console command description.</span>
<span class="sd">     *</span>
<span class="sd">     * @var string</span>
<span class="sd">     */</span>
    <span class="k">protected</span> <span class="nv">$description</span> <span class="o">=</span> <span class="s1">'Command description'</span><span class="p">;</span>

    <span class="sd">/**</span>
<span class="sd">     * Create a new command instance.</span>
<span class="sd">     *</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">__construct</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">parent</span><span class="o">::</span><span class="na">__construct</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * Execute the console command.</span>
<span class="sd">     *</span>
<span class="sd">     * @return mixed</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">handle</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">//</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td>
</tr></tbody></table>
</div>

<h3 class="ng-scope">②作成したコマンド操作のファイルをアプリケーションに登録</h3>

<p class="ng-scope">次にMovieScrapingファイルの内容をアプリケーションに登録する必要があります。そうすることでartisanコマンドとして利用することができます。登録は<code>app/Console/Kernel.php</code>ファイルのcommandsプロパティにて行います。</p>

<h3 class="ng-scope">
<i class="icon pen"></i> Kernel.phpファイルを以下のように編集しましょう</h3>

<div class="code-frame ng-scope" data-lang="php">
<div class="code-lang"><span class="bold">Kernel.php</span></div>
<table class="highlighttable"><tbody><tr>
<td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31</pre></div></td>
<td class="code">
<div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Console</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Console\Scheduling\Schedule</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Foundation\Console\Kernel</span> <span class="k">as</span> <span class="nx">ConsoleKernel</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Kernel</span> <span class="k">extends</span> <span class="nx">ConsoleKernel</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * The Artisan commands provided by your application.</span>
<span class="sd">     *</span>
<span class="sd">     * @var array</span>
<span class="sd">     */</span>
    <span class="k">protected</span> <span class="nv">$commands</span> <span class="o">=</span> <span class="p">[</span>
        <span class="nx">Commands\Inspire</span><span class="o">::</span><span class="na">class</span><span class="p">,</span>
<span class="hll">        <span class="nx">Commands\MovieScraping</span><span class="o">::</span><span class="na">class</span><span class="p">,</span>
</span>    <span class="p">];</span>

    <span class="sd">/**</span>
<span class="sd">     * Define the application's command schedule.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  \Illuminate\Console\Scheduling\Schedule  $schedule</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">protected</span> <span class="k">function</span> <span class="nf">schedule</span><span class="p">(</span><span class="nx">Schedule</span> <span class="nv">$schedule</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$schedule</span><span class="o">-&gt;</span><span class="na">command</span><span class="p">(</span><span class="s1">'inspire'</span><span class="p">)</span>
                 <span class="o">-&gt;</span><span class="na">hourly</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td>
</tr></tbody></table>
</div>

<p class="ng-scope">これでMovieScrapingファイルの内容をアプリケーションに登録できました。最後にmovie_scrapingコマンドの実行内容を記述していきます。</p>

<h3 class="ng-scope">③コマンドの実行内容を記入する</h3>

<p class="ng-scope">コマンドの実行内容は先ほど生成したMovieScraping.phpファイルにて行います。</p>

<p class="ng-scope">MovieScraping.phpファイルにおける重要な記述は以下の2つです。<br>
<code>$signatureプロパティ</code>・・・コマンド名<br>
<code>handle()メソッド</code>・・コマンドが入力されたときに実行される内容を記述する</p>

<p class="ng-scope">$signatureプロパティにはmovie_scrapingが指定されていると思います。これはファイル作成の際にcommandオプションに指定していたものが反映されています。commandオプションを指定せずにファイルを作成した場合は、追記する必要があります。今回は特に記述することはありません。</p>

<p class="ng-scope">handle()メソッドには実行内容を記述していきます。実行したいのはmovie_urls()メソッドです。movie_urlsは静的メソッドなので、<strong>クラス名::静的メソッド</strong>という形で実行できます。</p>

<h3 class="ng-scope">
<i class="icon pen"></i> handle()メソッド内を以下のように編集しましょう</h3>

<div class="code-frame ng-scope" data-lang="php">
<div class="code-lang"><span class="bold">MovieScraping.php</span></div>
<table class="highlighttable"><tbody><tr>
<td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43</pre></div></td>
<td class="code">
<div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Console\Commands</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Console\Command</span><span class="p">;</span>
<span class="hll"><span class="k">use</span> <span class="nx">App\Scraping</span><span class="p">;</span>
</span>
<span class="k">class</span> <span class="nc">MovieScraping</span> <span class="k">extends</span> <span class="nx">Command</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * The name and signature of the console command.</span>
<span class="sd">     *</span>
<span class="sd">     * @var string</span>
<span class="sd">     */</span>
    <span class="k">protected</span> <span class="nv">$signature</span> <span class="o">=</span> <span class="s1">'movie_scraping'</span><span class="p">;</span>

    <span class="sd">/**</span>
<span class="sd">     * The console command description.</span>
<span class="sd">     *</span>
<span class="sd">     * @var string</span>
<span class="sd">     */</span>
    <span class="k">protected</span> <span class="nv">$description</span> <span class="o">=</span> <span class="s1">'Command description'</span><span class="p">;</span>

    <span class="sd">/**</span>
<span class="sd">     * Create a new command instance.</span>
<span class="sd">     *</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">__construct</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">parent</span><span class="o">::</span><span class="na">__construct</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * Execute the console command.</span>
<span class="sd">     *</span>
<span class="sd">     * @return mixed</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">handle</span><span class="p">()</span>
    <span class="p">{</span>
<span class="hll">        <span class="nx">Scraping</span><span class="o">::</span><span class="na">movie_urls</span><span class="p">();</span>
</span>    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td>
</tr></tbody></table>
</div>

<p class="ng-scope">これでターミナルでphp artisan movie_scrapingコマンドを入力した際にmovie_urls()を実行できるようになりました。試しに実行してみましょう。</p>

<h3 class="ng-scope">④自作したコマンドを実行</h3>

<h3 class="ng-scope">
<i class="icon pen"></i> ターミナルで以下のように実行しましょう</h3>

<div class="code-frame ng-scope" data-lang="bash">
<div class="code-lang"><span class="bold">ターミナル</span></div>
<table class="highlighttable"><tbody><tr>
<td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td>
<td class="code">
<div class="highlight"><pre><span class="nv">$ </span>php artisan movie_scraping
get movies link URL
</pre></div>
</td>
</tr></tbody></table>
</div>

<p class="ng-scope">"get movies link URL"と表示されれば静的メソッド<code>movie_urls</code>は正常に実行できています。</p>

<p class="ng-scope"><form action="http://master.tech-camp.in/curriculums/851#" data-id="3942" class="ng-valid ng-scope ng-dirty ng-valid-parse">
  <h4 class="ng-binding">
    <i class="icon check_icon_01"></i>作業チェック
  </h4>
  <!-- ngRepeat: check in checkbox.checks --><label for="check-5508" ng-repeat="check in checkbox.checks" class="ng-scope"><input id="check-5508" name="check-5508" ng-change="change_checkbox_value(check)" ng-model="check.checked" type="checkbox" class="ng-valid ng-dirty ng-valid-parse ng-touched"><span ng-bind-html="check.text" class="ng-binding">movie_scrapingコマンドを自作することができた</span></label><!-- end ngRepeat: check in checkbox.checks --><label for="check-5509" ng-repeat="check in checkbox.checks" class="ng-scope"><input id="check-5509" name="check-5509" ng-change="change_checkbox_value(check)" ng-model="check.checked" type="checkbox" class="ng-valid ng-dirty ng-valid-parse ng-touched"><span ng-bind-html="check.text" class="ng-binding"><code>php artisan movie_scraping</code>を実行すると"get movies link URL"と表示された</span></label><!-- end ngRepeat: check in checkbox.checks -->
</form></p>

<h2 class="ng-scope" id="33">静的メソッドmovie_urls()</h2>

<p class="ng-scope"><code>Scraping.php</code>に記述されているScrapingクラスの静的メソッド<code>movie_urls()</code>は表示されている20件分の映画の個別ページのリンクURLを取得して、そのリンクを静的メソッド<code>get_product()</code>を渡す処理をします。</p>

<div class="code-frame ng-scope" data-lang="php">
<div class="code-lang"><span class="bold">Scraping.php</span></div>
<table class="highlighttable"><tbody><tr>
<td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td>
<td class="code">
<div class="highlight"><pre><span class="k">function</span> <span class="nf">static</span> <span class="nx">movie_urls</span><span class="p">()</span>
<span class="p">{</span>
    <span class="c1">// 映画の個別ページのURLを取得</span>
    <span class="c1">// get_product($link)を呼び出す</span>
<span class="p">}</span>
</pre></div>
</td>
</tr></tbody></table>
</div>

<h2 class="ng-scope" id="34">静的メソッドget_product()</h2>

<p class="ng-scope"><code>Scraping.php</code>に記述されているScrapingクラスのクラスメソッド<code>get_product</code>は引数として渡された個別ページのリンクURLを使って「作品名」と「作品画像のURL」をスクレイピングし、それらをproductsテーブルに保存する処理を書きます。</p>

<div class="code-frame ng-scope" data-lang="php">
<div class="code-lang"><span class="bold">Scraping.php</span></div>
<table class="highlighttable"><tbody><tr>
<td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td>
<td class="code">
<div class="highlight"><pre><span class="k">function</span> <span class="nf">static</span> <span class="nx">get_product</span><span class="p">(</span><span class="nv">$link</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// 「作品名」と「作品画像のURL」をスクレイピング</span>
    <span class="c1">// スクレイピングした「作品名」と「作品画像のURL」をproductsテーブルに保存</span>
<span class="p">}</span>
</pre></div>
</td>
</tr></tbody></table>
</div>

<p class="ng-scope"><i class="icon attention"></i> <code>echo 'get movies link URL'</code>と<code>echo 'get movie information'</code>は消してかまいません。</p>

<h2 class="ng-scope" id="35">映画情報をデータベースに保存しよう</h2>

<p class="ng-scope">映画情報を保存とはつまり、titleやimage_urlの値をproductsテーブルに保存することを意図しますが、このままだとデータベースに保存ができません。複数のデータを保存する際はモデルに$fillableもしくは$guardedプロパティを定義しなければいけないのでした。<br>
$fillableと$guardedプロパティの違いは以下のとおりです。</p>

<table class="ng-scope">
<thead>
<tr>
<th style="text-align: left">プロパティ</th>
<th style="text-align: left">指定方法</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left">$fillable</td>
<td style="text-align: left">指定したプロパティの更新を許可</td>
</tr>
<tr>
<td style="text-align: left">$guarded</td>
<td style="text-align: left">指定したプロパティ以外のプロパティの更新を許可</td>
</tr>
</tbody>
</table>

<p class="ng-scope"><br></p>

<h3 class="ng-scope">[例]</h3>

<p class="ng-scope">Sampleモデルを使ってsamplesテーブルのtitleとimageカラムにデータを保存したい場合</p>

<p class="ng-scope">samplesテーブルはid、title、image、created_at、updated_atカラムを保持しているとします。</p>

<div class="code-frame ng-scope" data-lang="php">
<div class="code-lang"><span class="bold">Sample.php</span></div>
<table class="highlighttable"><tbody><tr>
<td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</pre></div></td>
<td class="code">
<div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\Model</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Product</span> <span class="k">extends</span> <span class="nx">Model</span>
<span class="p">{</span>
    <span class="k">protected</span> <span class="nv">$fillable</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'title'</span><span class="p">,</span> <span class="s1">'image'</span><span class="p">];</span>
    <span class="nx">もしくは</span>
    <span class="k">protected</span> <span class="nv">$guraded</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'id'</span><span class="p">,</span> <span class="s1">'created_at'</span><span class="p">,</span> <span class="s1">'updated_at'</span><span class="p">];</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</td>
</tr></tbody></table>
</div>

<p class="ng-scope">このように複数データを保存する場合は、保存するカラム名をモデル内で指定する必要があります。例の場合は$fillableプロパティを使ったほうが見やすくすっきりするでしょう。</p>

<p class="ng-scope">今まで書いたスクレイピングのPHPファイル、<code>scraping_title.php</code>と<code>scraping_image.php</code>を用いて映画の「作品名」と「作品画像のURL」を取得し、productsテーブルにその情報を保存する処理を<code>Scraping.php</code>に書きましょう。</p>

<div class="challenge ng-scope">
  <h3>
<i class="icon crown"></i> 問題9：Productsテーブルに<a href="http://review-movie.herokuapp.com/" alt="movie-review">movie-review</a>から取得した映画20件の情報を保存しましょう</h3>
  <div class="challenge_box">
    <h5>作業ファイル：app/Scraping.php、app/Product.php</h5>
    <h5>ヒント：個別ページのスクレイピングごとにProductモデルのインスタンスを生成しましょう</h5>

<div class="code-frame" data-lang="php">
<div class="code-lang"><span class="bold">Scraping.php</span></div>
<table class="highlighttable"><tbody><tr>
<td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20</pre></div></td>
<td class="code">
<div class="highlight"><pre>    <span class="k">class</span>  <span class="nc">Scraping</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">movie_urls</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="c1">// ①simple_html_domをインクルードする</span>
            <span class="c1">// ②$linksという配列の空枠を作る</span>
            <span class="c1">// ③映画の全体ページのURLを取得</span>
            <span class="c1">// ④全体ページから映画20件の個別URLのタグを取得</span>
            <span class="c1">// ⑤個別URLのタグからhref要素を取り出し、$links配列に格納する</span>
            <span class="c1">// ⑥get_product()を実行する際にリンクを引数として渡す</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">get_product</span><span class="p">(</span><span class="nv">$link</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="c1">// ⑦映画の個別ページのURLを取得</span>
            <span class="c1">// ⑧plaintextメソッドを利用し映画のタイトルを取得</span>
            <span class="c1">// ⑨image_urlがあるsrc要素のみを取り出す</span>
            <span class="c1">// ①⓪new演算子、saveメソッドを使い、 スクレイピングした「映画タイトル」と「作品画像のURL」をproductsテーブルに保存</span>
        <span class="p">}</span>
    <span class="p">}</span>
</pre></div>
</td>
</tr></tbody></table>
</div>
   <curriculum-question-container data-order="9" class="ng-scope"><button class="answer" ng-click="show_answer()" ng-show="isSolved">解答と解説を見る</button><button class="solve ng-binding ng-hide" ng-click="solve()" ng-hide="isSolved">残り時間 26分 09秒</button><button class="solved ng-hide" ng-click="solved()" ng-show="isSolving">解けた</button>
</curriculum-question-container>
  </div>
</div>

<p class="ng-scope"><form action="http://master.tech-camp.in/curriculums/851#" data-id="3943" class="ng-pristine ng-valid ng-scope">
  <h4 class="ng-binding">
    <i class="icon check_icon_01"></i>作業チェック
  </h4>
  <!-- ngRepeat: check in checkbox.checks --><label for="check-5510" ng-repeat="check in checkbox.checks" class="ng-scope"><input id="check-5510" name="check-5510" ng-change="change_checkbox_value(check)" ng-model="check.checked" type="checkbox" class="ng-pristine ng-untouched ng-valid"><span ng-bind-html="check.text" class="ng-binding">movie_scrapingコマンドを使ってmovie_urls()メソッドを実行することが出来た</span></label><!-- end ngRepeat: check in checkbox.checks -->
</form></p>

<p class="ng-scope"><form action="http://master.tech-camp.in/curriculums/851#" data-id="3952" class="ng-pristine ng-valid ng-scope">
  <h4 class="ng-binding">
    <i class="icon check_icon_02"></i>課題チェック
  </h4>
  <!-- ngRepeat: check in checkbox.checks --><label for="check-5520" ng-repeat="check in checkbox.checks" class="ng-scope"><input id="check-5520" name="check-5520" ng-change="change_checkbox_value(check)" ng-model="check.checked" type="checkbox" class="ng-pristine ng-untouched ng-valid"><span ng-bind-html="check.text" class="ng-binding">データベースに映画情報を20件保存できた</span></label><!-- end ngRepeat: check in checkbox.checks -->
</form></p>

<h1 class="ng-scope" id="36">さらに映画の情報を充実させよう</h1>

<p class="ng-scope">これで映画レビューアプリケーションを作るための最低限の映画情報をデータベースに保存できました。しかしさすがに20件しか映画の情報がないのはさみしいですね。そこでスクレイピングのメソッドを拡張してより充実した映画の情報を取得できるようにしましょう。</p>

<h2 class="ng-scope" id="37">同じ映画の情報はデータベースに新規で保存できないようにしましょう</h2>

<p class="ng-scope">いまスクレイピングのメソッド<code>movie_urls()</code>を2回実行すると同じ映画が2つずつ保存されてしまいます。つまり、メソッドが実行されるたびに同じ映画がデータベース上に増えていってしまいます。これではまずいので<strong>同じタイトルの映画情報はデータベースに保存しないようにしましょう。</strong></p>

<h3 class="ng-scope">
<i class="icon information" id="term_386"></i> firstOrNewメソッド</h3>

<p class="ng-scope">インスタンス生成時に引数として渡した値を保持したレコードがあればそのレコードのインスタンスを返し、なければ新しくインスタンスを作るメソッドです。</p>

<h3 class="ng-scope">【例】</h3>

<ul class="ng-scope">
<li>ニックネームが"Shinbo"のユーザーがすでに保存されていれば取得し、保存されていなければ生成する</li>
</ul>

<div class="code-frame ng-scope" data-lang="php"><table class="highlighttable"><tbody><tr>
<td class="linenos"><div class="linenodiv"><pre>1</pre></div></td>
<td class="code">
<div class="highlight"><pre>  <span class="nv">$user</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="na">firstOrNew</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="s1">'nickname'</span> <span class="o">=&gt;</span> <span class="s1">'Shinbo'</span><span class="p">));</span>
</pre></div>
</td>
</tr></tbody></table></div>

<h3 class="ng-scope">【例-1】</h3>

<ul class="ng-scope">
<li>すでにニックネームが"Shinbo"のユーザーが保存されている場合</li>
</ul>

<div class="code-frame ng-scope" data-lang="php"><table class="highlighttable"><tbody><tr>
<td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td>
<td class="code">
<div class="highlight"><pre>  <span class="nv">$user</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="na">firstOrNew</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="s1">'nickname'</span> <span class="o">=&gt;</span> <span class="s1">'Shinbo'</span><span class="p">));</span>
  <span class="o">=&gt;</span> <span class="p">{</span><span class="s2">"id"</span><span class="o">:</span><span class="mi">1</span><span class="p">,</span><span class="s2">"nickname"</span><span class="o">:</span><span class="s2">"Shinbo"</span><span class="p">}</span>
</pre></div>
</td>
</tr></tbody></table></div>

<p class="ng-scope">すでにデータベースのUsersテーブルにニックネームが"Shinbo"のレコードが保存されている場合、そのレコードのインスタンスが取得されます。</p>

<h3 class="ng-scope">【例-2】</h3>

<ul class="ng-scope">
<li>まだニックネームが"Shinbo"のユーザーが保存されていない場合</li>
</ul>

<div class="code-frame ng-scope" data-lang="php"><table class="highlighttable"><tbody><tr>
<td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td>
<td class="code">
<div class="highlight"><pre>  <span class="nv">$user</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="na">firstOrNew</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="s1">'nickname'</span> <span class="o">=&gt;</span> <span class="s1">'Shinbo'</span><span class="p">));</span>
  <span class="o">=&gt;</span> <span class="p">{</span><span class="s2">"nickname"</span><span class="o">:</span><span class="s2">"Shinbo"</span><span class="p">}</span>
  <span class="k">echo</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">nickname</span>
  <span class="o">=&gt;</span> <span class="nx">Shinbo</span> <span class="c1">// Shinboがnicknameカラムに代入されている</span>
</pre></div>
</td>
</tr></tbody></table></div>

<p class="ng-scope">ニックネームが"Shinbo"のレコードが無い場合は新しくUserモデルのインスタンスが生成されます。生成されたインスタンスは<strong>"Shinbo"がnicknameに代入された状態</strong>となっています。</p>

<p class="ng-scope"><i class="icon attention"></i> firstOrNewではnew演算子と同様、<strong>インスタンスを生成しただけでデータベースに保存されていません</strong>。saveメソッドでデータベースに保存するのを忘れないようにしましょう。</p>

<div class="code-frame ng-scope" data-lang="php"><table class="highlighttable"><tbody><tr>
<td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td>
<td class="code">
<div class="highlight"><pre>  <span class="nv">$user</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="na">firstOrNew</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="s1">'nickname'</span> <span class="o">=&gt;</span> <span class="s1">'Shinbo'</span><span class="p">));</span>
  <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">save</span><span class="p">();</span>
</pre></div>
</td>
</tr></tbody></table></div>

<div class="challenge ng-scope">
  <h3>
<i class="icon crown"></i> 問題10：同じ映画の情報がデータベースにすでに保存されていたら、新規にインスタンスを作らずに既に保存されているインスタンスを更新するようにしましょう。</h3>
  <div class="challenge_box">
    <h5>作業ファイル：app/Scraping.php</h5>
    <h5>ヒント：productインスタンスを生成しているコードを書き換えましょう。</h5>

<div class="code-frame" data-lang="php">
<div class="code-lang"><span class="bold">Scraping.php</span></div>
<table class="highlighttable"><tbody><tr>
<td class="linenos"><div class="linenodiv"><pre>1</pre></div></td>
<td class="code">
<div class="highlight"><pre>    <span class="nv">$product</span> <span class="o">=</span> <span class="nx">Product</span><span class="o">::</span><span class="na">firstOrNew</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="s1">'検索されるカラム名'</span> <span class="o">=&gt;</span> <span class="nx">検索する値</span><span class="p">));</span>
</pre></div>
</td>
</tr></tbody></table>
</div>

   <curriculum-question-container data-order="10" class="ng-scope"><button class="answer ng-hide" ng-click="show_answer()" ng-show="isSolved">解答と解説を見る</button><button class="solve ng-binding" ng-click="solve()" ng-hide="isSolved">課題を解く</button><button class="solved ng-hide" ng-click="solved()" ng-show="isSolving">解けた</button>
</curriculum-question-container>
  </div>
</div>

<p class="ng-scope"><form action="http://master.tech-camp.in/curriculums/851#" data-id="3953" class="ng-pristine ng-valid ng-scope">
  <h4 class="ng-binding">
    <i class="icon check_icon_02"></i>課題チェック
  </h4>
  <!-- ngRepeat: check in checkbox.checks --><label for="check-5521" ng-repeat="check in checkbox.checks" class="ng-scope"><input id="check-5521" name="check-5521" ng-change="change_checkbox_value(check)" ng-model="check.checked" type="checkbox" class="ng-pristine ng-untouched ng-valid"><span ng-bind-html="check.text" class="ng-binding">同じ映画の情報はデータベースに新規で保存できないようにできた</span></label><!-- end ngRepeat: check in checkbox.checks -->
</form></p>

<h2 class="ng-scope" id="38">
<a href="http://review-movie.herokuapp.com/" target="_blank">movie-review</a>ですべてのページから映画の情報を取得できるようにしましょう</h2>

<p class="ng-scope">いまのスクレイピングのメソッドは<a href="http://review-movie.herokuapp.com/" target="_blank">movie-review)</a>の1ページ目の20件の映画しか取得していません。そこでこれから、<strong>2ページ目以降の映画の情報もすべて取得するスクレイピングを書いていきましょう。</strong></p>

<p class="ng-scope"><a href="http://review-movie.herokuapp.com/" target="_blank">movie-reivew</a>はページネーションを利用しています。各ページの下に次のページへのリンクがあります。これを使えば次のページのURLリンクをたどることができます。</p>

<p class="ng-scope"><img src="./スクレイピングで映画情報を取得しよう_files/309e3a32a5bc7c2dbf95d348f5642744.png" alt="https://tech-master.s3.amazonaws.com/uploads/curriculums//309e3a32a5bc7c2dbf95d348f5642744.png"></p>

<p class="ng-scope">次のページへのリンク先がなくなったときにスクレイピングを終了させます。</p>

<p class="ng-scope"><img src="./スクレイピングで映画情報を取得しよう_files/5ab28ff6b8579f8cebb230aedfb77bd2.png" alt="https://tech-master.s3.amazonaws.com/uploads/curriculums//5ab28ff6b8579f8cebb230aedfb77bd2.png"></p>

<div class="challenge ng-scope">
  <h3>
<i class="icon crown"></i> 問題11：<a href="http://review-movie.herokuapp.com/" target="_blank">movie-review</a>の全てのページにある映画のタイトル、映画の画像を取得しましょう。</h3>
  <div class="challenge_box">
    <h5>作業ファイル：app/Scraping.php</h5>

<div class="code-frame" data-lang="php">
<div class="code-lang"><span class="bold">Scraping.php</span></div>
<table class="highlighttable"><tbody><tr>
<td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41</pre></div></td>
<td class="code">
<div class="highlight"><pre> 
<span class="k">class</span> <span class="nc">Scraping</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">movie_urls</span>
    <span class="p">{</span>
        <span class="nv">$links</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>

        <span class="c1">// パスの部分を変数で定義(はじめは、空にしておきます)</span>
        <span class="nv">$next_url</span> <span class="o">=</span> <span class="s2">""</span><span class="p">;</span>
   
        <span class="k">while</span> <span class="p">(</span><span class="k">true</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="nv">$current_page</span> <span class="o">=</span> <span class="nx">file_get_html</span><span class="p">(</span><span class="s1">'http://review-movie.herokuapp.com/'</span> <span class="o">.</span> <span class="nv">$next_url</span><span class="p">);</span>
            <span class="nv">$elements</span> <span class="o">=</span> <span class="nv">$current_page</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">(</span><span class="s1">'.entry-title a'</span><span class="p">);</span>
            <span class="k">foreach</span> <span class="p">(</span><span class="nv">$elements</span> <span class="k">as</span> <span class="nv">$ele</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="nv">$links</span> <span class="o">=</span> <span class="nv">$ele</span><span class="o">-&gt;</span><span class="na">href</span><span class="p">;</span>
            <span class="p">}</span>
        
            <span class="c1">// 「次へ」を表すタグを取得</span>
            <span class="nv">$next_link</span> <span class="o">=</span> <span class="o">???</span>

            <span class="c1">// $next_linkがなかったらwhile文を抜ける</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">???</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="o">???</span>
            <span class="p">}</span>

            <span class="c1">// そのタグからhref属性の値を取得</span>
            <span class="nv">$next_url</span> <span class="o">=</span> <span class="o">???</span>
        <span class="p">}</span>

        <span class="k">foreach</span> <span class="p">(</span><span class="nv">$links</span> <span class="k">as</span> <span class="nv">$link</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="nx">Scraping</span><span class="o">::</span><span class="na">get_product</span><span class="p">(</span><span class="s1">'http://review-movie.herokuapp.com'</span> <span class="o">.</span> <span class="nv">$link</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
<span class="x">  </span>
</pre></div>
</td>
</tr></tbody></table>
</div>

   <curriculum-question-container data-order="11" class="ng-scope"><button class="answer ng-hide" ng-click="show_answer()" ng-show="isSolved">解答と解説を見る</button><button class="solve ng-binding" ng-click="solve()" ng-hide="isSolved">課題を解く</button><button class="solved ng-hide" ng-click="solved()" ng-show="isSolving">解けた</button>
</curriculum-question-container>
  </div>
</div>

<p class="ng-scope"><form action="http://master.tech-camp.in/curriculums/851#" data-id="3954" class="ng-pristine ng-valid ng-scope">
  <h4 class="ng-binding">
    <i class="icon check_icon_02"></i>課題チェック
  </h4>
  <!-- ngRepeat: check in checkbox.checks --><label for="check-5522" ng-repeat="check in checkbox.checks" class="ng-scope"><input id="check-5522" name="check-5522" ng-change="change_checkbox_value(check)" ng-model="check.checked" type="checkbox" class="ng-pristine ng-untouched ng-valid"><span ng-bind-html="check.text" class="ng-binding"><a href="http://review-movie.herokuapp.com/">movie-review(上映中の映画)</a>のすべてのページにある映画を取得できた</span></label><!-- end ngRepeat: check in checkbox.checks -->
</form></p>

<h2 class="ng-scope" id="39">Productsテーブルに「監督名」、「あらすじ」、「公開日」のカラムを追加しましょう</h2>

<p class="ng-scope">映画の情報は「監督名」や「あらすじ」、「公開日」など様々なものがあります。スクレイピングするならこれらの情報もまとめて取得しておきたいところです。</p>

<table class="ng-scope">
<thead>
<tr>
<th style="text-align: center">カラム名</th>
<th style="text-align: center">型</th>
<th style="text-align: center">情報</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center">director</td>
<td style="text-align: center">string</td>
<td style="text-align: center">監督名</td>
</tr>
<tr>
<td style="text-align: center">detail</td>
<td style="text-align: center">text</td>
<td style="text-align: center">あらすじ</td>
</tr>
<tr>
<td style="text-align: center">open_date</td>
<td style="text-align: center">string</td>
<td style="text-align: center">公開日</td>
</tr>
</tbody>
</table>

<p class="ng-scope"><br></p>

<h3 class="ng-scope">
<i class="icon information" id="term_387"></i> php artisan make:migrationコマンド</h3>

<p class="ng-scope">テーブルにカラムを追加したり、削除するような<strong>テーブルの構造を変えたいときもマイグレーションファイルを作成します。</strong>作成には<code>php artisan make:migration</code>コマンドを使用します。このコマンドはマイグレーションファイルを新しく作るためのものです。また、カラムを追加する場合は<code>--table=テーブル名</code>オプションを利用しましょう。</p>

<div class="code-frame ng-scope" data-lang="bash">
<div class="code-lang"><span class="bold">ターミナル</span></div>
<table class="highlighttable"><tbody><tr>
<td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td>
<td class="code">
<div class="highlight"><pre>  <span class="nv">$ </span>php artisan make:migration add_columns_to_products_table --table<span class="o">=</span>products
  <span class="c"># =&gt; マイグレーションファイルの作成</span>
</pre></div>
</td>
</tr></tbody></table>
</div>

<p class="ng-scope"><code>php artisan make:migration</code>に続けてファイル名を指定します。ファイル名は任意で構いません。その後に--tableオプションを用いてproductsテーブルを指定します。こうすることで、以下のようにproductsテーブルを指定した状態でマイグレーションファイルを作成することができるので、積極的に利用しましょう。「database &gt; migrations」に<strong>2016_08_21_112418_add_columns_to_products_table.php</strong>というファイルが作成されました。</p>

<h3 class="ng-scope">[例]</h3>

<div class="code-frame ng-scope" data-lang="php"><table class="highlighttable"><tbody><tr>
<td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td>
<td class="code">
<div class="highlight"><pre><span class="c1">// 中略</span>
<span class="k">public</span> <span class="k">function</span> <span class="nf">up</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nx">Schema</span><span class="o">::</span><span class="na">table</span><span class="p">(</span><span class="s1">'products'</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nx">Blueprint</span> <span class="nv">$table</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">//</span>
    <span class="p">});</span>
<span class="p">}</span>
</pre></div>
</td>
</tr></tbody></table></div>

<p class="ng-scope">メソッド<code>up</code>の中にテーブル構造の変更を書きます。<br>
例えば、<strong>Booksテーブル</strong>に<strong>Integer型</strong>のカラム<strong>price</strong>を追加するため</p>

<h3 class="ng-scope">[例]</h3>

<div class="code-frame ng-scope" data-lang="php">
<div class="code-lang"><span class="bold">2016_08_21_112418_add_columns_to_products_table.php</span></div>
<table class="highlighttable"><tbody><tr>
<td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td>
<td class="code">
<div class="highlight"><pre><span class="k">public</span> <span class="k">function</span> <span class="nf">up</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nx">Schema</span><span class="o">::</span><span class="na">table</span><span class="p">(</span><span class="s1">'products'</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nx">Blueprint</span> <span class="nv">$table</span><span class="p">)</span> <span class="p">{</span>
<span class="hll">        <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">integer</span><span class="p">(</span><span class="s1">'price'</span><span class="p">);</span>
</span>    <span class="p">});</span>
<span class="p">}</span>
</pre></div>
</td>
</tr></tbody></table>
</div>

<p class="ng-scope">カラムの追加の記述はテーブル作成の際と同様に書くことができます。</p>

<p class="ng-scope">複数のカラムを追加する場合は、以下のように改行を行い続けて記述します。</p>

<h3 class="ng-scope">[例]</h3>

<div class="code-frame ng-scope" data-lang="bash"><table class="highlighttable"><tbody><tr>
<td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td>
<td class="code">
<div class="highlight"><pre>  <span class="nv">$table</span>-&gt;型<span class="o">(</span><span class="s1">'カラム名'</span><span class="o">)</span><span class="p">;</span>
  <span class="nv">$table</span>-&gt;型<span class="o">(</span><span class="s1">'カラム名'</span><span class="o">)</span><span class="p">;</span>
</pre></div>
</td>
</tr></tbody></table></div>

<p class="ng-scope">マイグレーションファイルに書いたテーブルの変更内容をテーブルに反映させるにはターミナルで<code>php artisan migrate</code>コマンドを実行します。</p>

<p class="ng-scope">マイグレーションの実行</p>

<div class="code-frame ng-scope" data-lang="bash">
<div class="code-lang"><span class="bold">ターミナル</span></div>
<table class="highlighttable"><tbody><tr>
<td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td>
<td class="code">
<div class="highlight"><pre><span class="nv">$ </span>php artisan migrate
Migrated: 2016_08_21_112418_add_price_to_books_table
</pre></div>
</td>
</tr></tbody></table>
</div>

<p class="ng-scope">上の例ではマイグレーションファイルAddPriceToBooksTableが実行され、booksテーブル内にinteger型のpriceカラムが追加されました。</p>

<p class="ng-scope">このように<strong>テーブルの変更を行うときは必ずマイグレーションファイルを作成しましょう。</strong>また、分からなくなった際は<a href="http://master.tech-camp.in/curriculums/18#term_237" target="_self">php artisan migrateコマンド</a>を振り返りましょう。</p>

<hr class="ng-scope">

<p class="ng-scope"><i class="icon attention"></i> Sequel Proのようなデータベースを操作できるアプリケーションを使うとそのアプリケーションからカラムの追加や削除ができます。しかし、アプリケーションから操作してしまうと複数人で開発している場合、<strong>開発者ごとにデータベースのテーブル構造が異なる</strong>という問題が起きてしまいます。そのため、テーブル構造を変えるときは必ずマイグレーションファイルを作成し、マイグレーションを実行することでテーブル構造を操作するようにしましょう。</p>

<hr class="ng-scope">

<h3 class="ng-scope">
<i class="icon design"></i> 作業内容</h3>

<ul class="ng-scope">
<li>Productsテーブルに以下のカラムを追加する</li>
</ul>

<table class="ng-scope">
<thead>
<tr>
<th style="text-align: center">カラム名</th>
<th style="text-align: center">型</th>
<th style="text-align: center">情報</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center">director</td>
<td style="text-align: center">string</td>
<td style="text-align: center">監督名</td>
</tr>
<tr>
<td style="text-align: center">detail</td>
<td style="text-align: center">text</td>
<td style="text-align: center">あらすじ</td>
</tr>
<tr>
<td style="text-align: center">open_date</td>
<td style="text-align: center">string</td>
<td style="text-align: center">公開日</td>
</tr>
</tbody>
</table>

<h3 class="ng-scope">
<i class="icon files"></i> 編集するファイル</h3>

<ul class="ng-scope">
<li>ターミナル</li>
<li>db/migrate/(作成したマイグレーションファイル)</li>
</ul>

<h3 class="ng-scope">
<i class="icon crown"></i> ヒント</h3>

<ul class="ng-scope">
<li>カラムを追加するために<code>php artisan make:migrationコマンド</code>でマイグレーションファイルを作成しましょう</li>
<li>マイグレーションファイルの<code>up()メソッド</code>内に指定のカラムを追加するような記述をしましょう</li>
<li>マイグレーションファイルが出来たら、<code>php artisan migrateコマンド</code>でマイグレーションファイルを実行します</li>
</ul>

<h4 class="ng-scope">
<i class="icon attention"></i> <strong>Sequel Pro</strong>でカラムが追加されたか確認しましょう</h4>

<p class="ng-scope">きちんと追加されていれば、新たに３つのカラムがproductsテーブルの中に作成されています。</p>

<p class="ng-scope"><img src="./スクレイピングで映画情報を取得しよう_files/dbe9a6d0e6acf0df6bd112088f1100ce.png" alt="データベース"></p>

<p class="ng-scope"><form action="http://master.tech-camp.in/curriculums/851#" data-id="3955" class="ng-pristine ng-valid ng-scope">
  <h4 class="ng-binding">
    <i class="icon check_icon_02"></i>課題チェック
  </h4>
  <!-- ngRepeat: check in checkbox.checks --><label for="check-5523" ng-repeat="check in checkbox.checks" class="ng-scope"><input id="check-5523" name="check-5523" ng-change="change_checkbox_value(check)" ng-model="check.checked" type="checkbox" class="ng-pristine ng-untouched ng-valid"><span ng-bind-html="check.text" class="ng-binding">Productモデルに指定のカラムを追加できた</span></label><!-- end ngRepeat: check in checkbox.checks -->
</form></p>

<h2 class="ng-scope" id="40">映画の個別ページから「監督名」、「あらすじ」、「公開日」を取得してデータベースに保存しましょう</h2>

<p class="ng-scope">カラムを追加したら、それらのデータを実際にデータベースに保存したいですね。movie-reviewで映画の個別ページには「監督名」、「あらすじ」、「公開日」が載っています。これらをスクレイピングで取得し、Productsテーブルに保存しましょう。</p>

<p class="ng-scope">さて、すでに取得してある映画情報にカラムを追加しなくてはいけません。<code>firstOrNew</code>メソッドを使えば条件に当てはまるレコードがテーブルに保存されていればそのレコードのインスタンスを取得できます。</p>

<p class="ng-scope">取得したインスタンスのカラムを更新するには<code>インスタンス-&gt;カラム名 = 値</code>という記述方法を使うのでした。</p>

<div class="code-frame ng-scope" data-lang="php"><table class="highlighttable"><tbody><tr>
<td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td>
<td class="code">
<div class="highlight"><pre>  <span class="nv">$product</span> <span class="o">=</span> <span class="nx">Product</span><span class="o">::</span><span class="na">firstOrNew</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="s1">'title'</span> <span class="o">=&gt;</span> <span class="nv">$title</span><span class="p">,</span> <span class="s1">'image_url'</span> <span class="o">=&gt;</span> <span class="nv">$image_url</span><span class="p">));</span>
  <span class="c1">// カラムの更新</span>
  <span class="nv">$product</span><span class="o">-&gt;</span><span class="na">director</span> <span class="o">=</span> <span class="nx">監督名</span><span class="p">;</span>
  <span class="c1">// 中略</span>
  <span class="nv">$product</span><span class="o">-&gt;</span><span class="na">save</span><span class="p">();</span>
</pre></div>
</td>
</tr></tbody></table></div>

<p class="ng-scope">最後にsaveするのを忘れないようにしましょう。</p>

<h3 class="ng-scope">
<i class="icon design"></i> 作業内容</h3>

<ul class="ng-scope">
<li>映画の個別ページから「監督名」、「あらすじ」、「公開日」を取得する</li>
<li>取得した「監督名」、「あらすじ」、「公開日」の情報をインスタンスに更新する</li>
<li>実際にデータベースに保存する</li>
</ul>

<h3 class="ng-scope">
<i class="icon files"></i> 編集するファイル</h3>

<ul class="ng-scope">
<li>app/Scraping.php<br>
</li>
<li>ターミナル</li>
</ul>

<h3 class="ng-scope">
<i class="icon crown"></i> ヒント</h3>

<ul class="ng-scope">
<li>映画の個別ページで作品画像のURLを取得するときに、一緒にこれらの情報も取得しましょう</li>
<li>カラムの更新には<code>「インスタンス-&gt;カラム名 = 値」</code>の式を使いましょう</li>
<li>コードが書けたらターミナルで<code>php artisan movie_scraping</code>を実行しましょう</li>
</ul>

<h4 class="ng-scope">
<i class="icon attention"></i>Sequel Proのproductsテーブルを確認して、データが保存されているか確認しましょう</h4>

<p class="ng-scope">きちんと情報が保存されていれば、以下のように表示されます。</p>

<p class="ng-scope"><img src="./スクレイピングで映画情報を取得しよう_files/90ed69c1744e34c197fdcb6fab696d81.png" alt="https://tech-master.s3.amazonaws.com/uploads/curriculums//90ed69c1744e34c197fdcb6fab696d81.png"></p>

<p class="ng-scope"><form action="http://master.tech-camp.in/curriculums/851#" data-id="3956" class="ng-pristine ng-valid ng-scope">
  <h4 class="ng-binding">
    <i class="icon check_icon_02"></i>課題チェック
  </h4>
  <!-- ngRepeat: check in checkbox.checks --><label for="check-5524" ng-repeat="check in checkbox.checks" class="ng-scope"><input id="check-5524" name="check-5524" ng-change="change_checkbox_value(check)" ng-model="check.checked" type="checkbox" class="ng-pristine ng-untouched ng-valid"><span ng-bind-html="check.text" class="ng-binding">「監督名」、「あらすじ」、「公開日」をデータベースに保存できた</span></label><!-- end ngRepeat: check in checkbox.checks -->
</form></p>

<p class="ng-scope">以下が完成の一例です。他の記述の方法もありますので参考までにご確認ください。</p>

<div class="code-frame ng-scope" data-lang="php">
<div class="code-lang"><span class="bold">Scraping.php</span></div>
<table class="highlighttable"><tbody><tr>
<td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55</pre></div></td>
<td class="code">
<div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Product</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Scraping</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">movie_urls</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">require_once</span> <span class="s1">'simple_html_dom.php'</span><span class="p">;</span>

        <span class="nv">$links</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>
        <span class="nv">$next_url</span> <span class="o">=</span> <span class="s2">""</span><span class="p">;</span>

        <span class="k">while</span> <span class="p">(</span><span class="k">true</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="nv">$current_page</span> <span class="o">=</span> <span class="nx">file_get_html</span><span class="p">(</span><span class="s1">'http://review-movie.herokuapp.com/'</span> <span class="o">.</span> <span class="nv">$next_url</span><span class="p">);</span>
            <span class="nv">$elements</span> <span class="o">=</span> <span class="nv">$current_page</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">(</span><span class="s1">'.entry-title a'</span><span class="p">);</span>
            <span class="k">foreach</span> <span class="p">(</span><span class="nv">$elements</span> <span class="k">as</span> <span class="nv">$element</span><span class="p">)</span> <span class="p">{</span>
                <span class="nv">$links</span><span class="p">[]</span> <span class="o">=</span> <span class="nv">$element</span><span class="o">-&gt;</span><span class="na">href</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="nv">$next_link</span> <span class="o">=</span> <span class="nv">$current_page</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">(</span><span class="s1">'.pagination .next a'</span><span class="p">);</span>

            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$next_link</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="k">break</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="nv">$next_url</span> <span class="o">=</span> <span class="nv">$next_link</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">href</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">foreach</span> <span class="p">(</span><span class="nv">$links</span> <span class="k">as</span> <span class="nv">$link</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">Scraping</span><span class="o">::</span><span class="na">get_product</span><span class="p">(</span><span class="s1">'http://review-movie.herokuapp.com'</span> <span class="o">.</span> <span class="nv">$link</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">get_product</span><span class="p">(</span><span class="nv">$link</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$page</span> <span class="o">=</span> <span class="nx">file_get_html</span><span class="p">(</span><span class="nv">$link</span><span class="p">);</span>
        <span class="nv">$title</span> <span class="o">=</span> <span class="nv">$page</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">(</span><span class="s1">'.entry-title'</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">plaintext</span><span class="p">;</span>
        <span class="nv">$image_url</span> <span class="o">=</span> <span class="nv">$page</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">(</span><span class="s1">'.entry-content img'</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">src</span><span class="p">;</span>
        <span class="nv">$director</span> <span class="o">=</span> <span class="nv">$page</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">(</span><span class="s1">'.director span'</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">plaintext</span><span class="p">;</span>
        <span class="nv">$detail</span> <span class="o">=</span> <span class="nv">$page</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">(</span><span class="s1">'.entry-content p'</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">plaintext</span><span class="p">;</span>
        <span class="nv">$open_date</span> <span class="o">=</span> <span class="nv">$page</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">(</span><span class="s1">'.date span'</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">plaintext</span><span class="p">;</span>

        <span class="nv">$product</span> <span class="o">=</span> <span class="nx">Product</span><span class="o">::</span><span class="na">firstOrNew</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="s1">'title'</span> <span class="o">=&gt;</span> <span class="nv">$title</span><span class="p">,</span> <span class="s1">'image_url'</span> <span class="o">=&gt;</span> <span class="nv">$image_url</span><span class="p">));</span>
        <span class="nv">$product</span><span class="o">-&gt;</span><span class="na">director</span> <span class="o">=</span> <span class="nv">$director</span><span class="p">;</span>
        <span class="nv">$product</span><span class="o">-&gt;</span><span class="na">detail</span> <span class="o">=</span> <span class="nv">$detail</span><span class="p">;</span>
        <span class="nv">$product</span><span class="o">-&gt;</span><span class="na">open_date</span> <span class="o">=</span> <span class="nv">$open_date</span><span class="p">;</span>
        <span class="nv">$product</span><span class="o">-&gt;</span><span class="na">save</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</td>
</tr></tbody></table>
</div>

<p class="ng-scope">このようなソースコードが書けたら次のカリキュラムへ進みましょう。</p>
</div>
          <!-- ngIf: curriculum.short_test --><div class="short_test-box ng-scope" ng-if="curriculum.short_test">
  <div class="short_test-title">
    <h4>
      確認問題
    </h4>
    <p>
      お疲れ様でした！このカリキュラムの終わりに確認問題を解きましょう。
    </p>
  </div>
  <div class="short_test_score" id="shortTestInfo"></div>
  <div class="short_test-button">
    <a class="curriculum-short-test-button" ng-click="showShortTest(curriculum.short_test.id)">確認テストに挑戦する！</a>
  </div>
</div><!-- end ngIf: curriculum.short_test -->
        </div>
      </div>
      <div class="col-md-3 col-sm-12" id="curriculumSideContainer">
        <curriculum-side-wrap id="sideWrap" class="" style="width: 690px;">
          <ul class="list-group toc-tree" id="curriculumContents" style="max-height: 387px;">
  <li class="list-group-item disabled">
    目次
  </li>
  <!-- ngRepeat: content in contents --><li ng-repeat="content in contents" class="ng-scope">
    <a class="content-link ng-binding" id="contents1" ng-click="clickContent(content.h1.id)">学習目標</a>
    <ul class="list-group">
      <!-- ngRepeat: h2 in content.h2 track by $index -->
    </ul>
  </li><!-- end ngRepeat: content in contents --><li ng-repeat="content in contents" class="ng-scope">
    <a class="content-link ng-binding" id="contents2" ng-click="clickContent(content.h1.id)">学習キーワード</a>
    <ul class="list-group">
      <!-- ngRepeat: h2 in content.h2 track by $index -->
    </ul>
  </li><!-- end ngRepeat: content in contents --><li ng-repeat="content in contents" class="ng-scope">
    <a class="content-link ng-binding" id="contents3" ng-click="clickContent(content.h1.id)">映画のデータを用意しよう</a>
    <ul class="list-group">
      <!-- ngRepeat: h2 in content.h2 track by $index --><li ng-repeat="h2 in content.h2 track by $index" class="ng-scope">
        <a class="content-link ng-binding" id="contents4" ng-click="clickContent(h2.id)">映画のデータ</a>
      </li><!-- end ngRepeat: h2 in content.h2 track by $index --><li ng-repeat="h2 in content.h2 track by $index" class="ng-scope">
        <a class="content-link ng-binding" id="contents5" ng-click="clickContent(h2.id)">プログラムで映画の情報を取得しよう</a>
      </li><!-- end ngRepeat: h2 in content.h2 track by $index -->
    </ul>
  </li><!-- end ngRepeat: content in contents --><li ng-repeat="content in contents" class="ng-scope">
    <a class="content-link ng-binding" id="contents6" ng-click="clickContent(content.h1.id)">スクレイピング</a>
    <ul class="list-group">
      <!-- ngRepeat: h2 in content.h2 track by $index --><li ng-repeat="h2 in content.h2 track by $index" class="ng-scope">
        <a class="content-link ng-binding" id="contents7" ng-click="clickContent(h2.id)">スクレイピングとは</a>
      </li><!-- end ngRepeat: h2 in content.h2 track by $index --><li ng-repeat="h2 in content.h2 track by $index" class="ng-scope">
        <a class="content-link ng-binding" id="contents8" ng-click="clickContent(h2.id)">スクレイピングで映画情報を取得しよう</a>
      </li><!-- end ngRepeat: h2 in content.h2 track by $index --><li ng-repeat="h2 in content.h2 track by $index" class="ng-scope">
        <a class="content-link ng-binding" id="contents9" ng-click="clickContent(h2.id)">スクレイピングしてみよう</a>
      </li><!-- end ngRepeat: h2 in content.h2 track by $index --><li ng-repeat="h2 in content.h2 track by $index" class="ng-scope">
        <a class="content-link ng-binding" id="contents10" ng-click="clickContent(h2.id)">ウェブサイトのHTML情報を取得する</a>
      </li><!-- end ngRepeat: h2 in content.h2 track by $index --><li ng-repeat="h2 in content.h2 track by $index" class="ng-scope">
        <a class="content-link ng-binding" id="contents11" ng-click="clickContent(h2.id)">ウェブサイトのHTML情報を取得する</a>
      </li><!-- end ngRepeat: h2 in content.h2 track by $index --><li ng-repeat="h2 in content.h2 track by $index" class="ng-scope">
        <a class="content-link ng-binding" id="contents12" ng-click="clickContent(h2.id)">HTML情報から指定のタグ要素の情報を検索する</a>
      </li><!-- end ngRepeat: h2 in content.h2 track by $index --><li ng-repeat="h2 in content.h2 track by $index" class="ng-scope">
        <a class="content-link ng-binding" id="contents13" ng-click="clickContent(h2.id)">HTML情報からテキストを抜き出そう</a>
      </li><!-- end ngRepeat: h2 in content.h2 track by $index --><li ng-repeat="h2 in content.h2 track by $index" class="ng-scope">
        <a class="content-link ng-binding" id="contents14" ng-click="clickContent(h2.id)">HTML情報から属性の値を抜き出そう</a>
      </li><!-- end ngRepeat: h2 in content.h2 track by $index --><li ng-repeat="h2 in content.h2 track by $index" class="ng-scope">
        <a class="content-link ng-binding" id="contents15" ng-click="clickContent(h2.id)">スクレイピングの手順まとめ</a>
      </li><!-- end ngRepeat: h2 in content.h2 track by $index --><li ng-repeat="h2 in content.h2 track by $index" class="ng-scope">
        <a class="content-link ng-binding" id="contents16" ng-click="clickContent(h2.id)">実際にスクレイピングしてみよう</a>
      </li><!-- end ngRepeat: h2 in content.h2 track by $index --><li ng-repeat="h2 in content.h2 track by $index" class="ng-scope">
        <a class="content-link ng-binding" id="contents17" ng-click="clickContent(h2.id)">スクレイピング練習</a>
      </li><!-- end ngRepeat: h2 in content.h2 track by $index --><li ng-repeat="h2 in content.h2 track by $index" class="ng-scope">
        <a class="content-link ng-binding" id="contents18" ng-click="clickContent(h2.id)">練習問題を解いてみよう</a>
      </li><!-- end ngRepeat: h2 in content.h2 track by $index -->
    </ul>
  </li><!-- end ngRepeat: content in contents --><li ng-repeat="content in contents" class="ng-scope">
    <a class="content-link ng-binding" id="contents19" ng-click="clickContent(content.h1.id)">movie-reviewからのスクレイピング</a>
    <ul class="list-group">
      <!-- ngRepeat: h2 in content.h2 track by $index --><li ng-repeat="h2 in content.h2 track by $index" class="ng-scope">
        <a class="content-link ng-binding" id="contents20" ng-click="clickContent(h2.id)">作品名、作品画像のURLを取得しよう</a>
      </li><!-- end ngRepeat: h2 in content.h2 track by $index --><li ng-repeat="h2 in content.h2 track by $index" class="ng-scope">
        <a class="content-link ng-binding" id="contents21" ng-click="clickContent(h2.id)">映画情報のスクレイピング用のPHPファイルを作ろう</a>
      </li><!-- end ngRepeat: h2 in content.h2 track by $index --><li ng-repeat="h2 in content.h2 track by $index" class="ng-scope">
        <a class="content-link ng-binding" id="contents22" ng-click="clickContent(h2.id)">ウェブサイトのHTML構造を確認しよう</a>
      </li><!-- end ngRepeat: h2 in content.h2 track by $index --><li ng-repeat="h2 in content.h2 track by $index" class="ng-scope">
        <a class="content-link ng-binding" id="contents23" ng-click="clickContent(h2.id)">作品名を取得しよう①</a>
      </li><!-- end ngRepeat: h2 in content.h2 track by $index --><li ng-repeat="h2 in content.h2 track by $index" class="ng-scope">
        <a class="content-link ng-binding" id="contents24" ng-click="clickContent(h2.id)">作品画像のURLを取得しよう</a>
      </li><!-- end ngRepeat: h2 in content.h2 track by $index --><li ng-repeat="h2 in content.h2 track by $index" class="ng-scope">
        <a class="content-link ng-binding" id="contents25" ng-click="clickContent(h2.id)">作品画像のURLを取得しよう②</a>
      </li><!-- end ngRepeat: h2 in content.h2 track by $index --><li ng-repeat="h2 in content.h2 track by $index" class="ng-scope">
        <a class="content-link ng-binding" id="contents26" ng-click="clickContent(h2.id)">個別ページの作品画像のURLを取得しよう</a>
      </li><!-- end ngRepeat: h2 in content.h2 track by $index --><li ng-repeat="h2 in content.h2 track by $index" class="ng-scope">
        <a class="content-link ng-binding" id="contents27" ng-click="clickContent(h2.id)">20件分すべての映画の個別ページから作品画像のURLを取得しよう</a>
      </li><!-- end ngRepeat: h2 in content.h2 track by $index -->
    </ul>
  </li><!-- end ngRepeat: content in contents --><li ng-repeat="content in contents" class="ng-scope">
    <a class="content-link ng-binding" id="contents28" ng-click="clickContent(content.h1.id)">データベースに映画のデータを保存しよう</a>
    <ul class="list-group">
      <!-- ngRepeat: h2 in content.h2 track by $index --><li ng-repeat="h2 in content.h2 track by $index" class="ng-scope">
        <a class="content-link ng-binding" id="contents29" ng-click="clickContent(h2.id)">映画情報のモデルを作成しよう</a>
      </li><!-- end ngRepeat: h2 in content.h2 track by $index --><li ng-repeat="h2 in content.h2 track by $index" class="ng-scope">
        <a class="content-link ng-binding" id="contents30" ng-click="clickContent(h2.id)">映画情報をデータベースに保存するメソッドを書こう</a>
      </li><!-- end ngRepeat: h2 in content.h2 track by $index --><li ng-repeat="h2 in content.h2 track by $index" class="ng-scope">
        <a class="content-link ng-binding" id="contents31" ng-click="clickContent(h2.id)">記述するメソッドと実行方法</a>
      </li><!-- end ngRepeat: h2 in content.h2 track by $index --><li ng-repeat="h2 in content.h2 track by $index" class="ng-scope">
        <a class="content-link ng-binding" id="contents32" ng-click="clickContent(h2.id)">スクレイピング実行のためのコマンドを作成しよう</a>
      </li><!-- end ngRepeat: h2 in content.h2 track by $index --><li ng-repeat="h2 in content.h2 track by $index" class="ng-scope">
        <a class="content-link ng-binding" id="contents33" ng-click="clickContent(h2.id)">静的メソッドmovie_urls()</a>
      </li><!-- end ngRepeat: h2 in content.h2 track by $index --><li ng-repeat="h2 in content.h2 track by $index" class="ng-scope">
        <a class="content-link ng-binding" id="contents34" ng-click="clickContent(h2.id)">静的メソッドget_product()</a>
      </li><!-- end ngRepeat: h2 in content.h2 track by $index --><li ng-repeat="h2 in content.h2 track by $index" class="ng-scope">
        <a class="content-link ng-binding current" id="contents35" ng-click="clickContent(h2.id)">映画情報をデータベースに保存しよう</a>
      </li><!-- end ngRepeat: h2 in content.h2 track by $index -->
    </ul>
  </li><!-- end ngRepeat: content in contents --><li ng-repeat="content in contents" class="ng-scope">
    <a class="content-link ng-binding" id="contents36" ng-click="clickContent(content.h1.id)">さらに映画の情報を充実させよう</a>
    <ul class="list-group">
      <!-- ngRepeat: h2 in content.h2 track by $index --><li ng-repeat="h2 in content.h2 track by $index" class="ng-scope">
        <a class="content-link ng-binding" id="contents37" ng-click="clickContent(h2.id)">同じ映画の情報はデータベースに新規で保存できないようにしましょう</a>
      </li><!-- end ngRepeat: h2 in content.h2 track by $index --><li ng-repeat="h2 in content.h2 track by $index" class="ng-scope">
        <a class="content-link ng-binding" id="contents38" ng-click="clickContent(h2.id)">
movie-reviewですべてのページから映画の情報を取得できるようにしましょう</a>
      </li><!-- end ngRepeat: h2 in content.h2 track by $index --><li ng-repeat="h2 in content.h2 track by $index" class="ng-scope">
        <a class="content-link ng-binding" id="contents39" ng-click="clickContent(h2.id)">Productsテーブルに「監督名」、「あらすじ」、「公開日」のカラムを追加しましょう</a>
      </li><!-- end ngRepeat: h2 in content.h2 track by $index --><li ng-repeat="h2 in content.h2 track by $index" class="ng-scope">
        <a class="content-link ng-binding" id="contents40" ng-click="clickContent(h2.id)">映画の個別ページから「監督名」、「あらすじ」、「公開日」を取得してデータベースに保存しましょう</a>
      </li><!-- end ngRepeat: h2 in content.h2 track by $index -->
    </ul>
  </li><!-- end ngRepeat: content in contents -->
</ul>
          <div class="progress_box ng-scope" ng-show="check_count &gt; 0">
  <!-- ngIf: showTroubleShooting() -->
  <!-- ngIf: courseId != 9 && courseId != 10 --><p class="terms ng-scope" ng-if="courseId != 9 &amp;&amp; courseId != 10">
    分からない用語がある時：<br><a href="http://master.tech-camp.in/terms" target="_brank">用語一覧集</a>
  </p><!-- end ngIf: courseId != 9 && courseId != 10 -->
  <h4>
    進捗度<i id="numerator" class="ng-binding">22 / 32<span id="denominaotr"></span></i>
  </h4>
  <div class="progress">
    <div aria-valuemax="100" aria-valuemin="0" aria-valuenow="68.8" class="pregress-bar progress-bar-info ng-binding" role="progressbar" style="width: 68.8%;">
      68.8%
    </div>
  </div>
</div>
          <curriculum-glossary ng-show="curriculum.curriculum_type == 2 || curriculum.curriculum_type == 3" class="ng-hide"></curriculum-glossary>
          <button class="curriculum-report-button" ng-click="show_curriculum_report()">
            <img src="./スクレイピングで映画情報を取得しよう_files/idea.svg" width="20px" height="20px">
            | このカリキュラムへのご要望
          </button>
        </curriculum-side-wrap>
      </div>
    </div>
    <ul class="pager" ng-hide="loading">
  <li class="previous">
    <a ng-click="go_previous()" ng-show="curriculum.previous_id" class="">前のカリキュラム</a>
  </li>
  <li class="next">
    <a ng-class="{ disable: curriculum.short_test.can_see_next_curriculum == false }" ng-click="go_next()" ng-show="curriculum.next_id" class="disable">次のカリキュラム</a>
  </li>
</ul>
  </div>
</curriculum>
<div id="loading" ng-show="loading" class="ng-scope ng-isolate-scope ng-hide">
  <svg height="44" stroke="#444" viewBox="0 0 44 44" width="44" xmlns="http://www.w3.org/2000/svg"><g fill="none" fill-rule="evenodd" strole-width="2"><circle cx="22" cy="22" r="19.0069"><animate attributeName="r" begin="0s" calcMode="spline" dur="1.8s" keySplines="0.165, 0.84, 0.44, 1" keyTimes="0; 1" repeatCount="indefinite" values="1; 20"></animate><animate attributeName="stroke-opacity" begin="0s" calcMode="spline" dur="1.8s" keySplines="0.3, 0.61, 0.355, 1" keyTimes="0; 1" repeatCount="indefinite" values="1; 0"></animate></circle><circle cx="22" cy="22" r="7.48986"><animate attributeName="r" begin="-0.9s" calcMode="spline" dur="1.8s" keySplines="0.165, 0.84, 0.44, 1" keyTimes="0; 1" repeatCount="indefinite" values="1; 20"></animate><animate attributeName="stroke-opacity" begin="-0.9s" calcMode="spline" dur="1.8s" keySplines="0.3, 0.61, 0.355, 1" keyTimes="0; 1" repeatCount="indefinite" values="1; 0"></animate></circle></g></svg>
</div>

<div class="curriculum-image__modal modal ng-scope" id="curriculum-image__modal" role="dialog" tabindex="-1" style="width: 0px;">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button class="close" data-dismiss="modal" ng-click="close()"><span aria-hidden="true">×</span></button>
      </div>
      <div class="modal-body">
        <div class="curriculum-image__img__body">
          <img class="curriculum-image__img zoom-out" id="curriculum-image__img">
        </div>
      </div>
    </div>
  </div>
</div>

<style type="text/css" class="ng-scope">
  .curriculum-inner{position: relative;}
  #curriculumSideContainer{position: static;}
  #sideWrap{display: block;}
  .fixed-side{position: fixed; top :110px}
  .absoluted-side-bottom{position: absolute; bottom :0}
  .toc-tree{position: relative; overflow-y: auto;}
  .content-link {cursor: pointer;}
</style>
</div><div id="js-support-popwindow"><div class="popwindow_box" style="bottom: -400px;"><div id="minimization_btn"><h3>メンターを呼ぶ</h3><div class="minimization_btn">−</div></div><p>質問がある際は、こちらからメンターを呼ぶことができます</p><div class="form_box" id="before_sent"><form accept-charset="UTF-8" action="http://master.tech-camp.in/office_question_notifications" class="new_office_question_notification ng-pristine ng-valid" data-remote="true" id="new_office_question_notification" method="post"><div style="display:none"><input name="utf8" type="hidden" value="✓"></div><input id="office_question_notification_user_id" name="office_question_notification[user_id]" type="hidden" value="7534"><input id="office_question_notification_coming_log_id" name="office_question_notification[coming_log_id]" type="hidden" value="48626"><input class="form_box-address" id="office_question_notification_seat_number" name="office_question_notification[seat_number]" placeholder="座席番号を入力" type="number"><input class="form_box-submit" data-disable-with="送信中" disabled="disabled" name="commit" type="submit" value="メンターを呼ぶ"></form></div><div class="form_box_after" id="after_sent"><p>少々お待ちください</p></div><div class="form_box_after" id="not_sent"><p>エキスパートコースの方はこの時間は質問できません</p></div></div><div class="minimized_window" id="popwindow_box"><div class="minimized_window_btns"><a class="minimized_window_btn mentor_question_btn" id="maximization_btn">メンターを呼ぶ</a><a class="go_out_btn minimized_window_btn" data-method="patch" href="http://master.tech-camp.in/me/comings/7534?coming=go_out" rel="nofollow" target="_self">退席する</a></div></div></div><div id="office_map_panel"><div id="office_map_content"><div class="modal-close">× 閉じる</div><img alt="Office b map" src="./スクレイピングで映画情報を取得しよう_files/office_B_map-4e3458b1f36bf644a786bea9e5b2455a.jpeg"><hr><img alt="Office a map" src="./スクレイピングで映画情報を取得しよう_files/office_A_map-a3f60ec5e82fded6c214ff36497646f4.jpeg"></div></div><div class="tooltip" id="tooltip0"><p>研修内容で習った事関しては全て理解・習得し、1人で一通りできるようになる。</p></div></body></html>